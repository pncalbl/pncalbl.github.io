

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-t.png">
  <link rel="icon" href="/img/favicon-t.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="pncalbl">
  <meta name="keywords" content="计算机,开发,编程,代码,博客,技术">
  
  <title>SpringBoot 学习 - pncalbl</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"pncalbl.github.io","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/rss2.xml" title="pncalbl" type="application/rss+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>pncalbl</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/post.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="SpringBoot 学习">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      pncalbl
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-04 00:00" pubdate>
        2021年4月4日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      18.1k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      276
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SpringBoot 学习</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：5 个月前
                
              </p>
            
            <div class="markdown-body">
              <h1 id="SpringBoot-学习"><a href="#SpringBoot-学习" class="headerlink" title="SpringBoot 学习"></a>SpringBoot 学习</h1><h2 id="1-Spring-Boot-是什么"><a href="#1-Spring-Boot-是什么" class="headerlink" title="1 Spring Boot 是什么?"></a>1 Spring Boot 是什么?</h2><ul>
<li><p>Spring Boot 是由 Pivotal 团队提供的全新框架，其设计目的是用来简化新 Spring 应用的初始搭建以及开发过程。</p>
</li>
<li><p>在 Spring 框架这个大家族中，产生了很多衍生框架，比如 Spring、SpringMVC 框架等，Spring 的核心内容在于控制反转( IOC )和依赖注入( DI ),所谓控制反转并非是一种技术，而是一种思想，在操作方面是指在 Spring 配置文件中创建，依赖注入即为由 Spring 容器为应用程序的某个对象提供资源，比如 引用对象、常量数据等。</p>
</li>
<li><p>Spring Boot 是一个框架，一种全新的编程规范，他的产生简化了框架的使用，所谓简化是指简化了Spring众多框架中所需的大量且繁琐的配置文件，所以 Spring Boot 是一个服务于框架的框架，服务范围是简化配置文件。</p>
</li>
<li><p>Spring Boot 最明显的特点是，让文件配置变的相当简单、让应用部署变的简单（ Spring Boot 内置服务器，并装备启动类代码），可以快速开启一个 Web 容器进行开发。</p>
</li>
</ul>
<h3 id="1-1-程序打包"><a href="#1-1-程序打包" class="headerlink" title="1.1 程序打包"></a>1.1 程序打包</h3><ul>
<li><p>打包可能需要在 build 的 plugins 中加入以下插件，也可以通过降低 Spring Boot 的版本2.3。</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>

<span class="hljs-comment">&lt;!--spring-boot默认的配置,没有这个打包插件--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></code></pre></div>

</li>
</ul>
<h2 id="2-配置如何编写-yaml"><a href="#2-配置如何编写-yaml" class="headerlink" title="2 配置如何编写 yaml"></a>2 配置如何编写 yaml</h2><div class="code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8000</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span> <span class="hljs-string">default</span>
  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">user:</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">weak</span></code></pre></div>

<p>注意：冒号之后必须加空格</p>
<h2 id="3-自动装配原理"><a href="#3-自动装配原理" class="headerlink" title="3 自动装配原理"></a>3 自动装配原理</h2><h3 id="3-1-自动配置"><a href="#3-1-自动配置" class="headerlink" title="3.1 自动配置"></a>3.1 自动配置</h3><h5 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h5><ul>
<li>spring-boot-dependencies:  核心依赖在父工程中</li>
<li>我们在写或者引入一些 Spring Boot 依赖时候,不需要指定版本,就是因为有这些版本仓库</li>
</ul>
<h3 id="3-2-启动器"><a href="#3-2-启动器" class="headerlink" title="3.2 启动器"></a>3.2 启动器</h3><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<ul>
<li>说白了,启动器就是 Spring Boot 启动场景。</li>
<li>比如 spring-boot-starter-web ，他就会帮我们自动导入 web 环境的所有依赖！</li>
<li>Spring Boot 会将所有的功能场景，都变成一个个启动器</li>
<li>我们要使用什么功能，就只需找到对应的启动器就可以 <strong>stater</strong></li>
</ul>
<h3 id="3-3-主程序"><a href="#3-3-主程序" class="headerlink" title="3.3 主程序"></a>3.3 主程序</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// @SpringBootApplication: 标注这个类是一个Spring Boot 应用</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Springboot01HelloworldApplication</span> </span>&#123;

   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
      SpringApplication.run(Springboot01HelloworldApplication.class, args);
   &#125;

&#125;</code></pre></div>

<h3 id="3-4-注解"><a href="#3-4-注解" class="headerlink" title="3.4 注解"></a>3.4 注解</h3>   <div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootConfiguration</span>	<span class="hljs-comment">// Spring Boot 的配置</span>
	<span class="hljs-meta">@Configuration</span> 	<span class="hljs-comment">// Spring 的配置类</span>
		<span class="hljs-meta">@Component</span>		<span class="hljs-comment">// 说明这也是一个Spring的组件</span>
<span class="hljs-meta">@EnableAutoConfiguration</span>	  <span class="hljs-comment">// 自动配置包</span>
	<span class="hljs-meta">@AutoConfigurationPackage</span> <span class="hljs-comment">// 自动配置包</span>
	<span class="hljs-meta">@Import(&#123;AutoConfigurationPackages.Registrar.class&#125;)</span>	<span class="hljs-comment">// 自动配置包注册</span>
	<span class="hljs-meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span>	<span class="hljs-comment">// 自动配置导入选择</span></code></pre></div>

   <div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 获取所有的配置</span>
List&lt;String&gt; configurations = <span class="hljs-keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</code></pre></div>

   <div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> List&lt;String&gt; <span class="hljs-title">getCandidateConfigurations</span><span class="hljs-params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;
    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="hljs-keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="hljs-keyword">this</span>.getBeanClassLoader());
    Assert.notEmpty(configurations, <span class="hljs-string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);
    <span class="hljs-keyword">return</span> configurations;
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs xml">META-INF/spring.factories	// 自动配置的核心文件</code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210412222820485.png" alt="image-20210412222820485"></p>
<h2 id="4-Web开发"><a href="#4-Web开发" class="headerlink" title="4 Web开发"></a>4 Web开发</h2><h3 id="4-0-配置-log4j2"><a href="#4-0-配置-log4j2" class="headerlink" title="4.0 配置 log4j2"></a>4.0 配置 log4j2</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/244943401">参考文档</a></p>
<ul>
<li><p>修改 pom.xm</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--web--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-comment">&lt;!-- 去掉springboot默认配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--log4j2--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-comment">&lt;!-- 引入log4j2依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
</li>
<li><p>编写配置文件</p>
<ul>
<li><p>需要加入 JVM 参数 ：-Dlog4j.skipJansi=false</p>
</li>
<li><p>如果自定义了文件名，需要在application.yml中配置</p>
<div class="code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">logging:</span>
  <span class="hljs-attr">config:</span> <span class="hljs-string">xxxx.xml</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">cn.jay.repository:</span> <span class="hljs-string">trace</span></code></pre></div>
</li>
<li><p>可以直接在yml中配置日志输出格式</p>
<div class="code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">logging:</span>
  <span class="hljs-comment">#  控制台打印格式</span>
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">console:</span> <span class="hljs-string">&quot;%style&#123;%d&#123;yyyy-MM-dd HH:mm:ss&#125;&#125;&#123;red&#125; %style&#123;[%thread]&#125;&#123;blue&#125; %style&#123;%-5level&#125;&#123;cyan&#125;:%highlight&#123;%m%n&#125;&quot;</span>
  <span class="hljs-comment">#    log文件输出路径</span>
  <span class="hljs-attr">file:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">log</span></code></pre></div>

<p>这样就不用编写专门的log配置文件</p>
</li>
<li><p>默认文件名 log4j2-spring.xml</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hljs-comment">&lt;!--Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，你会看到log4j2内部各种详细输出--&gt;</span>
<span class="hljs-comment">&lt;!--monitorInterval：Log4j能够自动检测修改配置 文件和重新配置本身，设置间隔秒数--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">monitorInterval</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span>
	<span class="hljs-comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span>
	
	<span class="hljs-comment">&lt;!--变量配置--&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">Properties</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 格式化输出：%date表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度 %msg：日志消息，%n是换行符--&gt;</span>
		<span class="hljs-comment">&lt;!-- %logger&#123;36&#125; 表示 Logger 名字最长36个字符 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_PATTERN&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;%style&#123;%d&#123;yyyy-MM-dd HH:mm:ss&#125;&#125;&#123;red&#125; %style&#123;[%thread]&#125;&#123;blue&#125; %style&#123;%-5level&#125;&#123;cyan&#125;:%highlight&#123;%m%n&#125;&quot;</span>/&gt;</span>
		<span class="hljs-comment">&lt;!-- 定义日志存储的路径 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE_PATH&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;log&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE_NAME&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;springboot_04_web_db&quot;</span>/&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">Properties</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">appenders</span>&gt;</span>
		
		<span class="hljs-tag">&lt;<span class="hljs-name">console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Console&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span>
			<span class="hljs-comment">&lt;!--输出日志的格式--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span>
			<span class="hljs-comment">&lt;!--控制台只输出level及其以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">console</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，适合临时测试用--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">File</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Filelog&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/test.log&quot;</span> <span class="hljs-attr">append</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!-- 这个会打印出所有的info及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileInfo&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/info.log&quot;</span></span>
<span class="hljs-tag">		             <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-INFO-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span>
			<span class="hljs-comment">&lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>
				<span class="hljs-comment">&lt;!--interval属性用来指定多久滚动一次，默认是1 hour--&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;10MB&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件开始覆盖--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;15&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!-- 这个会打印出所有的warn及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileWarn&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/warn.log&quot;</span></span>
<span class="hljs-tag">		             <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-WARN-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span>
			<span class="hljs-comment">&lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;warn&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>
				<span class="hljs-comment">&lt;!--interval属性用来指定多久滚动一次，默认是1 hour--&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;10MB&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件开始覆盖--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;15&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!-- 这个会打印出所有的error及以下级别的信息，每次大小超过size，则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，作为存档--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFileError&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/error.log&quot;</span></span>
<span class="hljs-tag">		             <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-ERROR-%d&#123;yyyy-MM-dd&#125;_%i.log.gz&quot;</span>&gt;</span>
			<span class="hljs-comment">&lt;!--控制台只输出level及以上级别的信息（onMatch），其他的直接拒绝（onMismatch）--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">ThresholdFilter</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;error&quot;</span> <span class="hljs-attr">onMatch</span>=<span class="hljs-string">&quot;ACCEPT&quot;</span> <span class="hljs-attr">onMismatch</span>=<span class="hljs-string">&quot;DENY&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;$&#123;LOG_PATTERN&#125;&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span>
				<span class="hljs-comment">&lt;!--interval属性用来指定多久滚动一次，默认是1 hour--&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> <span class="hljs-attr">interval</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;10MB&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- DefaultRolloverStrategy属性如不设置，则默认为最多同一文件夹下7个文件开始覆盖--&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;15&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span>
	
	<span class="hljs-tag">&lt;/<span class="hljs-name">appenders</span>&gt;</span>
	
	<span class="hljs-comment">&lt;!--Logger节点用来单独指定日志的形式，比如要为指定包下的class指定不同的日志级别等。--&gt;</span>
	<span class="hljs-comment">&lt;!--然后定义loggers，只有定义了logger并引入的appender，appender才会生效--&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">loggers</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--过滤掉spring和mybatis的一些无用的DEBUG信息--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.mybatis&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span>
		<span class="hljs-comment">&lt;!--监控系统信息--&gt;</span>
		<span class="hljs-comment">&lt;!--若是additivity设为false，则 子Logger 只会在自己的appender里输出，而不会在 父Logger 的appender里输出。--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.springframework&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">Logger</span>&gt;</span>
		
		<span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Console&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;Filelog&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileInfo&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileWarn&quot;</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;RollingFileError&quot;</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">loggers</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></code></pre></div>



</li>
</ul>
</li>
</ul>
<div class="code-wrapper"><pre><code>-   配置参数说明

    -   机制：如果一条日志信息的级别大于等于配置文件的级别，就记录。
    -   trace：追踪，就是程序推进一下，可以写个trace输出
    -   trace：追踪，就是程序推进一下，可以写个trace输出
    -   debug：调试，一般作为最低级别，trace基本不用。
    -   info：输出重要的信息，使用较多
    -   warn：警告，有些信息不是错误信息，但也要给程序员一些提示。
    -   error：错误信息。用的也很多。
    -   fatal：致命错误。

-   输出源

    -   CONSOLE（输出到控制台）
    -   FILE（输出到文件）

-   格式

    -   SimpleLayout：以简单的形式显示

    -   HTMLLayout：以HTML表格显示

    -   PatternLayout：自定义形式显示

        <pre><code class="hljs xml">%d&#123;yyyy-MM-dd HH:mm:ss, SSS&#125; : 日志生产时间,输出到毫秒的时间
%-5level : 输出日志级别，-5表示左对齐并且固定输出5个字符，如果不足在右边补0
%c : logger的名称(%logger)
%t : 输出当前线程名称
%p : 日志输出格式
%m : 日志内容，即 logger.info(&quot;message&quot;)
%n : 换行符
%C : Java类名(%F)
%L : 行号
%M : 方法名
%l : 输出语句所在的行数, 包括类名、方法名、文件名、行数
hostName : 本地机器名
hostAddress : 本地ip地址</code></pre></div>



    -   示例

        <div class="code-wrapper"><pre><code class="hljs xml">PatternLayout pattern = &quot;&quot;%style&#123;%d&#123;yyyy-MM-dd HH:mm:ss&#125;&#125;&#123;red&#125; %style&#123;[%thread]&#125;&#123;blue&#125; %style&#123;%-5level&#125;&#123;cyan&#125;:%highlight&#123;%m%n&#125;&quot;</code></pre></div></code></pre><ul>
<li><p>使用</p>
<ul>
<li><p>获取logger对象</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> org.slf4j.Logger logger = LoggerFactory.getLogger(Log4j2Controller.class);</code></pre></div>
</li>
<li><p>使用 @Slf4j 注解 </p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 使用 @Slf4j 注解 , 可以简化 logger 的获取</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;

	<span class="hljs-meta">@Resource</span>
	<span class="hljs-keyword">private</span> UserMapper userMapper;


	<span class="hljs-meta">@GetMapping(value = &quot;/list&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">queryList</span><span class="hljs-params">()</span> </span>&#123;
		List&lt;User&gt; users = userMapper.queryUserList();
		log.info(<span class="hljs-string">&quot;查询所有用户成功.&quot;</span>);
		<span class="hljs-keyword">return</span> users;
	&#125;
&#125;</code></pre></div>



</li>
</ul>
</li>
</ul>
<h3 id="4-1-静态资源导入"><a href="#4-1-静态资源导入" class="headerlink" title="4.1 静态资源导入"></a>4.1 静态资源导入</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;
    <span class="hljs-keyword">super</span>.addResourceHandlers(registry);
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) &#123;
        logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);
    &#125; <span class="hljs-keyword">else</span> &#123;
        ServletContext servletContext = <span class="hljs-keyword">this</span>.getServletContext();
        <span class="hljs-keyword">this</span>.addResourceHandler(registry, <span class="hljs-string">&quot;/webjars/**&quot;</span>, <span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);
        <span class="hljs-keyword">this</span>.addResourceHandler(registry, <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;
            registration.addResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations());
            <span class="hljs-keyword">if</span> (servletContext != <span class="hljs-keyword">null</span>) &#123;
                registration.addResourceLocations(<span class="hljs-keyword">new</span> Resource[]&#123;<span class="hljs-keyword">new</span> ServletContextResource(servletContext, <span class="hljs-string">&quot;/&quot;</span>)&#125;);
            &#125;

        &#125;);
    &#125;
&#125;</code></pre></div>

<p>总结:</p>
<ol>
<li><p>在springboot，我们可以使用以下方式处理静态资源</p>
<ul>
<li>webjars    <strong>localhost:8080/webjars/</strong></li>
<li>public, static, /**, resources    localhost:8080/</li>
</ul>
</li>
<li><p>优先级：resources &gt; static(默认) &gt; public</p>
</li>
</ol>
<h3 id="4-2-首页如何定制"><a href="#4-2-首页如何定制" class="headerlink" title="4.2 首页如何定制"></a>4.2 首页如何定制</h3><ul>
<li><p>模板引擎</p>
</li>
<li><p>使用thymeleaf， 只需要导入对应的依赖就行了</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Thymeleaf--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
</li>
<li><p>在自己写的 controller 上加注解 @Controller </p>
</li>
<li><p>@RestController注解<br>相当于@Controller+@ResponseBody两个注解的结合，返回json数据不需要在方法前面加@ResponseBody注解了，但使用@RestController这个注解，就不能返回jsp,html页面，视图解析器无法解析jsp,html页面</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 如果，你想自定义一些定制化功能，只要写这个组件，然后将它交给springboot，springboot就会帮我们自动装配</span>
<span class="hljs-comment">// 扩展springmvc配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;

   <span class="hljs-meta">@Bean</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> ViewResolver <span class="hljs-title">myViewResolver</span><span class="hljs-params">()</span> </span>&#123;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyViewResolver();
   &#125;

   <span class="hljs-comment">// 自定义了一个自己的视图解析器</span>
   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyViewResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ViewResolver</span> </span>&#123;

      <span class="hljs-meta">@Override</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> View <span class="hljs-title">resolveViewName</span><span class="hljs-params">(String s, Locale locale)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
      &#125;
   &#125;
&#125;</code></pre></div>



</li>
</ul>
<h3 id="4-3-国际化"><a href="#4-3-国际化" class="headerlink" title="4.3 国际化"></a>4.3 国际化</h3><ul>
<li><p>新建文件夹 i8n (international)</p>
</li>
<li><p>login.properties</p>
</li>
<li><p>login_zh_CN.properties</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">login.btn</span>=<span class="hljs-string">登录</span>
<span class="hljs-meta">login.password</span>=<span class="hljs-string">密码</span>
<span class="hljs-meta">login.remember</span>=<span class="hljs-string">记住我</span>
<span class="hljs-meta">login.tip</span>=<span class="hljs-string">请登录</span>
<span class="hljs-meta">login.username</span>=<span class="hljs-string">用户名</span></code></pre></div>
</li>
<li><p>login_en_US.properties</p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">login.btn</span>=<span class="hljs-string">Sign in</span>
<span class="hljs-meta">login.password</span>=<span class="hljs-string">Password</span>
<span class="hljs-meta">login.remember</span>=<span class="hljs-string">Remember me</span>
<span class="hljs-meta">login.tip</span>=<span class="hljs-string">Please sign in</span>
<span class="hljs-meta">login.username</span>=<span class="hljs-string">Username</span></code></pre></div>
</li>
<li><p>编写自己的本地解析器 MyLocaleResolver </p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLocaleResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">LocaleResolver</span> </span>&#123;

   <span class="hljs-comment">// 解析请求</span>
   <span class="hljs-meta">@Override</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> Locale <span class="hljs-title">resolveLocale</span><span class="hljs-params">(HttpServletRequest httpServletRequest)</span> </span>&#123;
      <span class="hljs-comment">// 获取请求中的参数</span>
      String language = httpServletRequest.getParameter(<span class="hljs-string">&quot;l&quot;</span>);
      Locale locale = Locale.getDefault();    <span class="hljs-comment">// 如果没有就使用默认的</span>

      <span class="hljs-comment">// 如果请求的链接携带了国际化的参数</span>
      <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(language)) &#123;
         <span class="hljs-comment">// zh_CN</span>
         String[] split = language.split(<span class="hljs-string">&quot;_&quot;</span>);
         <span class="hljs-comment">// 国家 地区</span>
         locale = <span class="hljs-keyword">new</span> Locale(split[<span class="hljs-number">0</span>], split[<span class="hljs-number">1</span>]);
      &#125;
      <span class="hljs-keyword">return</span> locale;
   &#125;

   <span class="hljs-meta">@Override</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLocale</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;

   &#125;
&#125;</code></pre></div>
</li>
<li><p>在 MyMvcConfig 配置增加</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// 自定义的国际化组件</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> LocaleResolver <span class="hljs-title">localeResolver</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyLocaleResolver();
&#125;</code></pre></div>
</li>
<li><p>修改静态资源</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/user/login&#125;&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mb-4&quot;</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">&quot;@&#123;/asserts/img/bootstrap-solid.svg&#125;&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;72&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;72&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;h3 mb-3 font-weight-normal&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;#&#123;login.tip&#125;&quot;</span>&gt;</span>Please sign in<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

	<span class="hljs-comment">&lt;!--如果msg的值为空, 则不显示错误消息--&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: red&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;not #strings.isEmpty(msg)&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">th:placeholder</span>=<span class="hljs-string">&quot;#&#123;login.username&#125;&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;&quot;</span></span>
<span class="hljs-tag">		       <span class="hljs-attr">autofocus</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sr-only&quot;</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">th:placeholder</span>=<span class="hljs-string">&quot;#&#123;login.password&#125;&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;checkbox mb-3&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;remember-me&quot;</span>&gt;</span> [[#&#123;login.remember&#125;]]
		<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>[[#&#123;login.btn&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mt-5 mb-3 text-muted&quot;</span>&gt;</span>© 2020-2021<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/index.html(l=&#x27;zh_CN&#x27;)&#125;&quot;</span>&gt;</span>中文<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/index.html(l=&#x27;en_US&#x27;)&#125;&quot;</span>&gt;</span>English<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div>

</li>
</ul>
<h3 id="4-4-用户登录"><a href="#4-4-用户登录" class="headerlink" title="4.4 用户登录"></a>4.4 用户登录</h3><ul>
<li><p>编写 LoginController</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.controller;

<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;
<span class="hljs-keyword">import</span> org.thymeleaf.util.StringUtils;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;


<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginController</span> </span>&#123;

   <span class="hljs-meta">@RequestMapping(value = &quot;/user/login&quot;)</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span>
<span class="hljs-function"><span class="hljs-params">                       <span class="hljs-meta">@RequestParam(&quot;password&quot;)</span> String password,</span></span>
<span class="hljs-function"><span class="hljs-params">                       Model model, HttpSession session)</span> </span>&#123;
      <span class="hljs-comment">// 具体的业务</span>
      <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(username) &amp;&amp; <span class="hljs-string">&quot;123456&quot;</span>.equals(password)) &#123;
         session.setAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>, username);
         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/main.html&quot;</span>;
      &#125; <span class="hljs-keyword">else</span> &#123;
         <span class="hljs-comment">// 告诉用户, 你登陆失败</span>
         model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;用户名或者密码错误!&quot;</span>);
         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;
      &#125;
   &#125;
&#125;</code></pre></div>
</li>
<li><p>在 MyMvcConfig 配置增加</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;
   registry.addViewController(<span class="hljs-string">&quot;/&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);
   registry.addViewController(<span class="hljs-string">&quot;/index.html&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);
   registry.addViewController(<span class="hljs-string">&quot;/main.html&quot;</span>).setViewName(<span class="hljs-string">&quot;dashboard&quot;</span>);
&#125;</code></pre></div>

</li>
</ul>
<h3 id="4-5-登录拦截"><a href="#4-5-登录拦截" class="headerlink" title="4.5 登录拦截"></a>4.5 登录拦截</h3><ul>
<li><p>编写 LoginHandlerInterceptor 拦截器</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.config;

<span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;


<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginHandlerInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;

   <span class="hljs-meta">@Override</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
      <span class="hljs-comment">// 登录成功之后, 应该有用户的Session</span>
      Object loginUser = request.getSession().getAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>);
      <span class="hljs-keyword">if</span> (loginUser == <span class="hljs-keyword">null</span>) &#123;
         request.setAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;没有权限, 请先登录!&quot;</span>);
         request.getRequestDispatcher(<span class="hljs-string">&quot;/index.html&quot;</span>).forward(request, response);
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
      &#125;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
   &#125;
&#125;</code></pre></div>
</li>
<li><p>在 MyMvcConfig 配置增加</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;
   registry.addInterceptor(<span class="hljs-keyword">new</span> LoginHandlerInterceptor())
         .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>).excludePathPatterns(<span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>, <span class="hljs-string">&quot;/asserts/**&quot;</span>);

&#125;</code></pre></div>

</li>
</ul>
<p>注意：看一下静态资源是否正常导出，以及所有的bean是否注入，以防止空指针异常。</p>
<h2 id="5-集成数据库-Druid"><a href="#5-集成数据库-Druid" class="headerlink" title="5 集成数据库: Druid"></a>5 集成数据库: Druid</h2><p>注意 thymeleaf 版本可能导致视图无法解析最好直接导入springboot的启动器</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Thymeleaf--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<h3 id="5-0-Druid简介"><a href="#5-0-Druid简介" class="headerlink" title="5.0 Druid简介"></a>5.0 Druid简介</h3><p>Java程序很大一部分要操作数据库，为了提高性能操作数据库的时候，又不得不使用数据库连接池。</p>
<p>Druid 是阿里巴巴开源平台上一个数据库连接池实现，结合了 C3P0、DBCP 等 DB 池的优点，同时加入了日志监控。</p>
<p>Druid 可以很好的监控 DB 池连接和 SQL 的执行情况，天生就是针对监控而生的 DB 连接池。</p>
<p>Druid已经在阿里巴巴部署了超过600个应用，经过一年多生产环境大规模部署的严苛考验。</p>
<p>Spring Boot 2.0 以上默认使用 Hikari 数据源，可以说 Hikari 与 Driud 都是当前 Java Web 上最优秀的数据源，我们来重点介绍 Spring Boot 如何集成 Druid 数据源，如何实现数据库监控。</p>
<p>Github地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/">https://github.com/alibaba/druid/</a></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/640" alt="图片"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/640" alt="图片"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/640" alt="图片"></p>
<h3 id="5-1-配置数据源"><a href="#5-1-配置数据源" class="headerlink" title="5.1 配置数据源"></a>5.1 配置数据源</h3><ol>
<li><p>添加上 Druid 数据源依赖。</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--druid--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
</li>
<li><p>切换数据源；之前已经说过 Spring Boot 2.0 以上默认使用 com.zaxxer.hikari.HikariDataSource 数据源，但可以 通过 spring.datasource.type 指定数据源。</p>
<div class="code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/springbootweb?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=true&amp;serverTimezone=GMT</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span></code></pre></div>
</li>
<li><p>数据源切换之后，在测试类中注入 DataSource，然后获取到它，输出一看便知是否成功切换；</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210513213156118.png" alt="image-20210513213156118"></p>
</li>
</ol>
<ol start="4">
<li><p>切换成功！既然切换成功，就可以设置数据源连接初始化大小、最大连接数、等待时间、最小连接数 等设置项；可以查看源码</p>
<div class="code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-comment">#?serverTimezone=UTC解决时区的报错</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>

    <span class="hljs-comment">#Spring Boot 默认是不注入这些属性值的，需要自己绑定</span>
    <span class="hljs-comment">#druid 数据源专有配置</span>
    <span class="hljs-attr">initialSize:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">minIdle:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">maxActive:</span> <span class="hljs-number">20</span>
    <span class="hljs-attr">maxWait:</span> <span class="hljs-number">60000</span>
    <span class="hljs-attr">timeBetweenEvictionRunsMillis:</span> <span class="hljs-number">60000</span>
    <span class="hljs-attr">minEvictableIdleTimeMillis:</span> <span class="hljs-number">300000</span>
    <span class="hljs-attr">validationQuery:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-string">FROM</span> <span class="hljs-string">DUAL</span>
    <span class="hljs-attr">testWhileIdle:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">testOnBorrow:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">testOnReturn:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">poolPreparedStatements:</span> <span class="hljs-literal">true</span>

    <span class="hljs-comment">#配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入</span>
    <span class="hljs-comment">#如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority</span>
    <span class="hljs-comment">#则导入 log4j2 依赖即可，需要加 虚拟机参数 ：-Dlog4j.skipJansi=false 彩色才能生效</span>
    <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall,log4j2</span>
    <span class="hljs-attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="hljs-number">20</span>
    <span class="hljs-attr">useGlobalDataSourceStat:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">connectionProperties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></code></pre></div>
</li>
<li><p>现在需要程序员自己为 DruidDataSource 绑定全局配置文件中的参数，再添加到容器中，而不再使用 Spring Boot 的自动生成了；我们需要 自己添加 DruidDataSource 组件到容器中，并绑定属性；</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfig</span> </span>&#123;

   <span class="hljs-comment">/*</span>
<span class="hljs-comment">      将自定义的 Druid数据源添加到容器中，不再让 Spring Boot 自动创建</span>
<span class="hljs-comment">      绑定全局配置文件中的 druid 数据源属性到 com.alibaba.druid.pool.DruidDataSource从而让它们生效</span>
<span class="hljs-comment">      @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)：作用就是将 全局配置文件中</span>
<span class="hljs-comment">      前缀为 spring.datasource的属性值注入到 com.alibaba.druid.pool.DruidDataSource 的同名参数中</span>
<span class="hljs-comment">    */</span>
   <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span>
   <span class="hljs-meta">@Bean</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">druidDataSource</span><span class="hljs-params">()</span> </span>&#123;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DruidDataSource();
   &#125;

&#125;</code></pre></div>
</li>
<li><p>去测试类中测试一下；看是否成功！</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;
	<span class="hljs-comment">//看一下默认数据源</span>
	System.out.println(dataSource.getClass());
	<span class="hljs-comment">//获得连接</span>
	Connection connection = dataSource.getConnection();
	System.out.println(connection);
    
	DruidDataSource druidDataSource = (DruidDataSource) dataSource;
	System.out.println(<span class="hljs-string">&quot;druidDataSource 数据源最大连接数：&quot;</span> + druidDataSource.getMaxActive());
	System.out.println(<span class="hljs-string">&quot;druidDataSource 数据源初始化连接数：&quot;</span> + druidDataSource.getInitialSize());
    
	<span class="hljs-comment">//关闭连接</span>
	connection.close();
&#125;</code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210514000156060.png" alt="image-20210514000156060"></p>
</li>
</ol>
<h3 id="5-2-配置Druid数据源监控"><a href="#5-2-配置Druid数据源监控" class="headerlink" title="5.2 配置Druid数据源监控"></a>5.2 配置Druid数据源监控</h3><p>Druid 数据源具有监控的功能，并提供了一个 web 界面方便用户查看，类似安装 路由器 时，人家也提供了一个默认的 web 页面。</p>
<ul>
<li><p>所以第一步需要设置 Druid 的后台管理页面，比如 登录账号、密码 等；配置后台管理；</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//配置 Druid 监控管理后台的Servlet；</span>
<span class="hljs-comment">//内置 Servlet 容器时没有web.xml文件，所以使用 Spring Boot 的注册 Servlet 方式</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">statViewServlet</span><span class="hljs-params">()</span> </span>&#123;
    ServletRegistrationBean bean = <span class="hljs-keyword">new</span> ServletRegistrationBean(<span class="hljs-keyword">new</span> StatViewServlet(), <span class="hljs-string">&quot;/druid/*&quot;</span>);

    <span class="hljs-comment">// 这些参数可以在 com.alibaba.druid.support.http.StatViewServlet </span>
    <span class="hljs-comment">// 的父类 com.alibaba.druid.support.http.ResourceServlet 中找到</span>
    Map&lt;String, String&gt; initParams = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    initParams.put(<span class="hljs-string">&quot;loginUsername&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>); <span class="hljs-comment">//后台管理界面的登录账号</span>
    initParams.put(<span class="hljs-string">&quot;loginPassword&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>); <span class="hljs-comment">//后台管理界面的登录密码</span>

    <span class="hljs-comment">//后台允许谁可以访问</span>
    <span class="hljs-comment">//initParams.put(&quot;allow&quot;, &quot;localhost&quot;)：表示只有本机可以访问</span>
    <span class="hljs-comment">//initParams.put(&quot;allow&quot;, &quot;&quot;)：为空或者为null时，表示允许所有访问</span>
    initParams.put(<span class="hljs-string">&quot;allow&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);
    <span class="hljs-comment">//deny：Druid 后台拒绝谁访问</span>
    <span class="hljs-comment">//initParams.put(&quot;kuangshen&quot;, &quot;192.168.1.20&quot;);表示禁止此ip访问</span>

    <span class="hljs-comment">//设置初始化参数</span>
    bean.setInitParameters(initParams);
    <span class="hljs-keyword">return</span> bean;
&#125;</code></pre></div>

<ul>
<li><p>配置完毕后，我们可以选择访问 ：<a target="_blank" rel="noopener" href="http://localhost:8080/druid/login.html">http://localhost:8080/druid/login.html</a></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210514011355470.png" alt="image-20210514011355470"></p>
</li>
<li><p>进入之后</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210514011404820.png" alt="image-20210514011404820"></p>
</li>
</ul>
</li>
<li><p><strong>配置 Druid web 监控 filter 过滤器</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//配置 Druid 监控 之  web 监控的 filter</span>
<span class="hljs-comment">//WebStatFilter：用于配置Web和Druid数据源之间的管理关联监控统计</span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">webStatFilter</span><span class="hljs-params">()</span> </span>&#123;
    FilterRegistrationBean bean = <span class="hljs-keyword">new</span> FilterRegistrationBean();
    bean.setFilter(<span class="hljs-keyword">new</span> WebStatFilter());

    <span class="hljs-comment">//exclusions：设置哪些请求进行过滤排除掉，从而不进行统计</span>
    Map&lt;String, String&gt; initParams = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    initParams.put(<span class="hljs-string">&quot;exclusions&quot;</span>, <span class="hljs-string">&quot;*.js,*.css,/druid/*,/jdbc/*&quot;</span>);
    bean.setInitParameters(initParams);

    <span class="hljs-comment">//&quot;/*&quot; 表示过滤所有请求</span>
    bean.setUrlPatterns(Arrays.asList(<span class="hljs-string">&quot;/*&quot;</span>));
    <span class="hljs-keyword">return</span> bean;
&#125;</code></pre></div>

<p>平时在工作中，按需求进行配置即可，主要用作监控！</p>
</li>
</ul>
<h2 id="6-整合Mybatis框架"><a href="#6-整合Mybatis框架" class="headerlink" title="6 整合Mybatis框架"></a>6 整合Mybatis框架</h2><h3 id="6-1-POM"><a href="#6-1-POM" class="headerlink" title="6.1 POM"></a>6.1 POM</h3><div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>

    <span class="hljs-comment">&lt;!--</span>
<span class="hljs-comment">   依赖的顺序最后不要变,因为引入log4j2, 需要排除web自带的logging</span>
<span class="hljs-comment">   所以web在前, log4j2在后, 约定大于配置</span>
<span class="hljs-comment">  --&gt;</span>
    <span class="hljs-comment">&lt;!--web--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--log4j2--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--test--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--lombok--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.18<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--jdbc--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.8.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--mybatis--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--mysql--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!--druid--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!--Thymeleaf--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>

<h3 id="6-2-写YML"><a href="#6-2-写YML" class="headerlink" title="6.2 写YML"></a>6.2 写YML</h3><div class="code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">banner:</span>
    <span class="hljs-attr">location:</span> <span class="hljs-string">banner.txt</span>
  <span class="hljs-attr">thymeleaf:</span>
    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=true&amp;serverTimezone=GMT</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>

    <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall,log4j2</span>
    <span class="hljs-attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="hljs-number">20</span>
    <span class="hljs-attr">useGlobalDataSourceStat:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">connectionProperties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span>

<span class="hljs-attr">logging:</span>
  <span class="hljs-comment">#  控制台打印格式</span>
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">console:</span> <span class="hljs-string">&quot;%style&#123;%d&#123;yyyy-MM-dd HH:mm:ss&#125;&#125;&#123;red&#125; %style&#123;[%thread]&#125;&#123;blue&#125; %style&#123;%-5level&#125;&#123;cyan&#125;:%highlight&#123;%m%n&#125;&quot;</span>
  <span class="hljs-comment">#    log文件输出路径</span>
  <span class="hljs-attr">file:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">log</span>

<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.pnca.pojo</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:com/pnca/mapper/*Mapper.xml</span></code></pre></div>

<p>测试数据能否连接</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210517200138052.png" alt="image-20210517200138052"></p>
<h3 id="6-3-实体类"><a href="#6-3-实体类" class="headerlink" title="6.3 实体类"></a>6.3 实体类</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.pojo;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> pncalbl</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2021/5/17 19:49</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@e</span>-mail pncalbl@qq.com</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span>
<span class="hljs-comment"> **/</span>

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;
   <span class="hljs-keyword">private</span> String name;
   <span class="hljs-keyword">private</span> String pwd;
&#125;</code></pre></div>

<h3 id="6-4-Mapper"><a href="#6-4-Mapper" class="headerlink" title="6.4 Mapper"></a>6.4 Mapper</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// @Mapper, 表示这是一个 mybatis 的 mapper 类</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;
	<span class="hljs-function">List&lt;User&gt; <span class="hljs-title">queryUserList</span><span class="hljs-params">()</span></span>;

	<span class="hljs-function">User <span class="hljs-title">queryUserById</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>;

	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span></span>;

	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(User user)</span></span>;

	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>;
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span>
<span class="hljs-meta">		<span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span>
<span class="hljs-meta">		<span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.pnca.mapper.UserMapper&quot;</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>
		select u.id, u.name, u.pwd
		from mybatis.user u;
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>
		select u.id, u.name, u.pwd
		from mybatis.user u
		where u.id = #&#123;id&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>
		insert into mybatis.user (id, name, pwd)
		values (#&#123;id&#125;, #&#123;name&#125;, #&#123;pwd&#125;)
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span>
		update mybatis.user u
		set u.name = #&#123;name&#125;,
		    u.pwd  = #&#123;pwd&#125;
		where u.id = #&#123;id&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUser&quot;</span>&gt;</span>
		delete
		from mybatis.user u
		where u.id = #&#123;id&#125;
	<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div>

<h3 id="6-5-Controller"><a href="#6-5-Controller" class="headerlink" title="6.5 Controller"></a>6.5 Controller</h3><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping(value = &quot;/user&quot;)</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;

	<span class="hljs-meta">@Resource</span>
	<span class="hljs-keyword">private</span> UserMapper userMapper;

	<span class="hljs-meta">@GetMapping(value = &quot;/list&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">queryList</span><span class="hljs-params">(Model model)</span> </span>&#123;
		List&lt;User&gt; users = userMapper.queryUserList();
		log.info(<span class="hljs-string">&quot;=============&gt; 查询所有用户成功.&quot;</span>);
		log.info(String.valueOf(users));
		model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, users);
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user/list&quot;</span>;
	&#125;

	<span class="hljs-meta">@GetMapping(value = &quot;/query/&#123;id&#125;&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">queryUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id, Model model)</span> </span>&#123;
		User user = userMapper.queryUserById(id);
		log.info(<span class="hljs-string">&quot;=============&gt; 查询用户&quot;</span> + id + <span class="hljs-string">&quot; 成功.&quot;</span>);
		model.addAttribute(<span class="hljs-string">&quot;user&quot;</span>, user);
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/user/list&quot;</span>;
	&#125;

	<span class="hljs-meta">@GetMapping(value = &quot;/add&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addUser</span><span class="hljs-params">(User user)</span> </span>&#123;
		<span class="hljs-keyword">int</span> i = userMapper.addUser(user);
		<span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) &#123;
			log.info(<span class="hljs-string">&quot;=============&gt; 增加用户&quot;</span> + user.getName() + <span class="hljs-string">&quot;成功.&quot;</span>);
		&#125; <span class="hljs-keyword">else</span> &#123;
			log.info(<span class="hljs-string">&quot;=============&gt; 增加用户&quot;</span> + user.getName() + <span class="hljs-string">&quot;失败.&quot;</span>);
		&#125;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/user/list&quot;</span>;
	&#125;

	<span class="hljs-meta">@GetMapping(value = &quot;/update&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">updateUser</span><span class="hljs-params">(User user)</span> </span>&#123;
		<span class="hljs-keyword">int</span> i = userMapper.updateUser(user);
		<span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) &#123;
			log.info(<span class="hljs-string">&quot;=============&gt; 更新用户&quot;</span> + user.getName() + <span class="hljs-string">&quot; 成功.&quot;</span>);
		&#125; <span class="hljs-keyword">else</span> &#123;
			log.info(<span class="hljs-string">&quot;=============&gt; 更新用户&quot;</span> + user.getName() + <span class="hljs-string">&quot; 失败.&quot;</span>);
		&#125;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/user/list&quot;</span>;
	&#125;

	<span class="hljs-meta">@GetMapping(value = &quot;/delete/&#123;id&#125;&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;
		<span class="hljs-keyword">int</span> i = userMapper.deleteUser(id);
		<span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) &#123;
			log.info(<span class="hljs-string">&quot;=============&gt; 删除用户&quot;</span> + id + <span class="hljs-string">&quot; 成功.&quot;</span>);
		&#125; <span class="hljs-keyword">else</span> &#123;
			log.info(<span class="hljs-string">&quot;=============&gt; 删除用户&quot;</span> + id + <span class="hljs-string">&quot; 失败.&quot;</span>);
		&#125;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/user/list&quot;</span>;
	&#125;

&#125;</code></pre></div>

<p>list.html</p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>用户列表<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table-responsive&quot;</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table table-striped table-sm&quot;</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;user:$&#123;users&#125;&quot;</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.getId()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.getName()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user.getPwd()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>



<h3 id="6-6-测试"><a href="#6-6-测试" class="headerlink" title="6.6 测试"></a>6.6 测试</h3><p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210518130701698.png" alt="image-20210518130701698"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210518130726107.png" alt="image-20210518130726107"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210518130754077.png" alt="image-20210518130754077"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210518130802626.png" alt="image-20210518130802626"></p>
<h2 id="7-SpringSecurity"><a href="#7-SpringSecurity" class="headerlink" title="7 SpringSecurity"></a>7 SpringSecurity</h2><h3 id="7-1-为什么使用安全框架"><a href="#7-1-为什么使用安全框架" class="headerlink" title="7.1 为什么使用安全框架?"></a>7.1 为什么使用安全框架?</h3><ul>
<li><p>在 Web 开发中，安全一直是非常重要的一个方面。安全虽然属于应用的非功能性需求，但是应该在应用开发的初期就考虑进来。如果在应用开发的后期才考虑安全的问题，就可能陷入一个两难的境地：</p>
<ul>
<li>一方面，应用存在严重的安全漏洞，无法满足用户的要求，并可能造成用户的隐私数据被攻击者窃取；</li>
<li>另一方面，应用的基本架构已经确定，要修复安全漏洞，可能需要对系统的架构做出比较重大的调整，因而需要更多的开发时间，影响应用的发布进程。因此，从应用开发的第一天就应该把安全相关的因素考虑进来，并在整个应用的开发过程中。</li>
</ul>
</li>
<li><p>市面上存在比较有名的：Shiro，Spring Security ！</p>
</li>
<li><p>这里需要阐述一下的是，每一个框架的出现都是为了解决某一问题而产生了，那么Spring Security框架的出现是为了解决什么问题呢？</p>
</li>
<li><p>首先我们看下它的官网介绍：Spring Security官网地址</p>
<ul>
<li>Spring Security is a powerful and highly customizable authentication and access-control framework. It is the de-facto standard for securing Spring-based applications.</li>
<li>Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它实际上是保护基于spring的应用程序的标准。</li>
<li>Spring Security is a framework that focuses on providing both authentication and authorization to Java applications. Like all Spring projects, the real power of Spring Security is found in how easily it can be extended to meet custom requirements</li>
<li>Spring Security是一个框架，侧重于为Java应用程序提供身份验证和授权。与所有Spring项目一样，Spring安全性的真正强大之处在于它可以轻松地扩展以满足定制需求</li>
</ul>
</li>
<li><p>从官网的介绍中可以知道这是一个权限框架。想我们之前做项目是没有使用框架是怎么控制权限的？对于权限 一般会细分为功能权限，访问权限，和菜单权限。代码会写的非常的繁琐，冗余。</p>
</li>
<li><p>怎么解决之前写权限代码繁琐，冗余的问题，一些主流框架就应运而生而Spring Scecurity就是其中的一种。</p>
</li>
<li><p>Spring 是一个非常流行和成功的 Java 应用开发框架。Spring Security 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。一般来说，Web 应用的安全性包括用户（Authentication）和用户授权（Authorization）两个部分。</p>
<ul>
<li>用户认证指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。</li>
<li>用户授权指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。</li>
</ul>
</li>
<li><p>对于上面提到的两种应用情景，Spring Security 框架都有很好的支持。</p>
<ul>
<li>在用户认证方面，Spring Security 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。</li>
<li>在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List，ACL），可以对应用中的领域对象进行细粒度的控制。</li>
</ul>
</li>
</ul>
<h3 id="7-2-搭建基础环境"><a href="#7-2-搭建基础环境" class="headerlink" title="7.2 搭建基础环境"></a>7.2 搭建基础环境</h3><ul>
<li><p>POM</p>
<div class="code-wrapper"><pre><code class="hljs xml-dtd">&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;
		&lt;&#x2F;dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;&#x2F;artifactId&gt;
		&lt;&#x2F;dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;
		&lt;&#x2F;dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.thymeleaf.extras&lt;&#x2F;groupId&gt;
			&lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;&#x2F;artifactId&gt;
		&lt;&#x2F;dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;
			&lt;scope&gt;test&lt;&#x2F;scope&gt;
		&lt;&#x2F;dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.security&lt;&#x2F;groupId&gt;
			&lt;artifactId&gt;spring-security-test&lt;&#x2F;artifactId&gt;
			&lt;scope&gt;test&lt;&#x2F;scope&gt;
		&lt;&#x2F;dependency&gt;
	&lt;&#x2F;dependencies&gt;</code></pre></div>
</li>
<li><p>导入静态资源</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210521000651281.png" alt="image-20210521000651281"></p>
</li>
<li><p>Controller</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.controller;

<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> pncalbl</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2021/5/20 23:46</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@e</span>-mail pncalbl@qq.com</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span>
<span class="hljs-comment"> **/</span>

<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RouterController</span> </span>&#123;

	<span class="hljs-meta">@RequestMapping(value = &#123;&quot;/&quot;, &quot;/index&quot;&#125;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">()</span> </span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;
	&#125;

	<span class="hljs-meta">@RequestMapping(value = &quot;/toLogin&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toLogin</span><span class="hljs-params">()</span> </span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/login&quot;</span>;
	&#125;

	<span class="hljs-meta">@RequestMapping(value = &quot;/level1/&#123;id&#125;&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toLogin1</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span> </span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/level1/&quot;</span> + id;
	&#125;

	<span class="hljs-meta">@RequestMapping(value = &quot;/level2/&#123;id&#125;&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toLogin2</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span> </span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/level2/&quot;</span> + id;
	&#125;

	<span class="hljs-meta">@RequestMapping(value = &quot;/level3/&#123;id&#125;&quot;)</span>
	<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toLogin3</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span> </span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/level3/&quot;</span> + id;
	&#125;
&#125;</code></pre></div>
</li>
<li><p>启动测试</p>
<ul>
<li><p>用户名: user</p>
</li>
<li><p>密码: 控制台打印</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210521000823763.png" alt="image-20210521000823763"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210521000837727.png" alt="image-20210521000837727"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210521000850040.png" alt="image-20210521000850040"></p>
</li>
</ul>
</li>
</ul>
<h3 id="7-3用户认证和授权"><a href="#7-3用户认证和授权" class="headerlink" title="7.3用户认证和授权"></a>7.3用户认证和授权</h3><p>认证: Authenticate</p>
<p>授权: Authorization</p>
<blockquote>
<p>  WebSecurityConfigAdapter: 自定义Security策略</p>
<p>  AuthenticationManagerBuilder: 自定义认证策略</p>
<p>  @EnableWebSecurity: 开启WebSecurity模式</p>
</blockquote>
<ul>
<li><p>自定义Security策略</p>
<ul>
<li><p>模板</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
		<span class="hljs-keyword">super</span>.configure(http);
	&#125;
&#125;</code></pre></div>
</li>
<li><p>完整</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;

	<span class="hljs-comment">// 授权</span>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
		<span class="hljs-comment">// 首页所有人可以访问, 功能页只有对应权限的人才能访问</span>
		<span class="hljs-comment">// 请求授权的规则</span>
		http.authorizeRequests()
				.antMatchers(<span class="hljs-string">&quot;/&quot;</span>).permitAll()
				.antMatchers(<span class="hljs-string">&quot;/level1/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip1&quot;</span>)
				.antMatchers(<span class="hljs-string">&quot;/level2/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip2&quot;</span>)
				.antMatchers(<span class="hljs-string">&quot;/level3/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip3&quot;</span>);

		<span class="hljs-comment">// 没有权限默认会跳到登录页面, 需要开启登录的页面</span>
		http.formLogin();
	&#125;

	<span class="hljs-comment">// 认证 springboot 2.1.x 可以直接使用</span>
	<span class="hljs-comment">// 过高版本, 密码需要编码: PasswordEncoder</span>
	<span class="hljs-comment">// 在 Spring Security 5.0+ 新增了很多的加密方法 MD5</span>
	<span class="hljs-meta">@Override</span>
	<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;

		<span class="hljs-comment">// 这些数据正常应该从数据中读取</span>
		auth.inMemoryAuthentication().passwordEncoder(<span class="hljs-keyword">new</span> BCryptPasswordEncoder())
				.withUser(<span class="hljs-string">&quot;pnca&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;123456&quot;</span>)).roles(<span class="hljs-string">&quot;vip2&quot;</span>, <span class="hljs-string">&quot;vip3&quot;</span>)
				.and().withUser(<span class="hljs-string">&quot;root&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;123456&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>, <span class="hljs-string">&quot;vip2&quot;</span>, <span class="hljs-string">&quot;vip3&quot;</span>)
				.and().withUser(<span class="hljs-string">&quot;guest&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;123456&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>);
	&#125;
&#125;</code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210521010431174.png" alt="image-20210521010431174"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210521010441726.png" alt="image-20210521010441726"></p>
</li>
</ul>
</li>
<li><p>自定义认证策略</p>
</li>
</ul>
<h3 id="7-4-注销及权限控制"><a href="#7-4-注销及权限控制" class="headerlink" title="7.4 注销及权限控制"></a>7.4 注销及权限控制</h3><ol>
<li><p>开启自动配置的注销的功能</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//定制请求的授权规则</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
   <span class="hljs-comment">//....</span>
   <span class="hljs-comment">//开启自动配置的注销的功能</span>
      <span class="hljs-comment">// /logout 注销请求</span>
   http.logout();
&#125;</code></pre></div>
</li>
<li><p>我们在前端，增加一个注销的按钮，index.html 导航栏中</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;address card icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 注销
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></code></pre></div>
</li>
<li><p>我们可以去测试一下，登录成功后点击注销，发现注销完毕会跳转到登录页面！</p>
</li>
<li><p>但是，我们想让他注销成功后，依旧可以跳转到首页，该怎么处理呢？</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">// .logoutSuccessUrl(&quot;/&quot;); 注销成功来到首页</span>
http.logout().logoutSuccessUrl(<span class="hljs-string">&quot;/&quot;</span>);</code></pre></div>
</li>
<li><p>测试，注销完毕后，发现跳转到首页OK</p>
</li>
<li><p>我们现在又来一个需求：用户没有登录的时候，导航栏上只显示登录按钮，用户登录之后，导航栏可以显示登录的用户信息及注销按钮！还有就是，比如kuangshen这个用户，它只有 vip2，vip3功能，那么登录则只显示这两个功能，而vip1的功能菜单不显示！这个就是真实的网站情况了！该如何做呢？</p>
<ul>
<li><p>我们需要结合thymeleaf中的一些功能</p>
</li>
<li><p>sec：authorize=”isAuthenticated()”:是否认证登录！来显示不同的页面</p>
</li>
<li><p>Maven依赖：</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity4 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
</li>
</ul>
</li>
<li><p>修改我们的 前端页面</p>
<ul>
<li><p>导入命名空间</p>
<div class="code-wrapper"><pre><code class="hljs xml">xmlns:sec=&quot;http://www.thymeleaf.org/thymeleaf-extras-springsecurity5&quot;</code></pre></div>
</li>
<li><p>修改导航栏，增加认证判断</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--登录注销--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;right menu&quot;</span>&gt;</span>

   <span class="hljs-comment">&lt;!--如果未登录--&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;!isAuthenticated()&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;address card icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 登录
       <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

   <span class="hljs-comment">&lt;!--如果已登录--&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;isAuthenticated()&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;address card icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
          用户名：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">sec:authentication</span>=<span class="hljs-string">&quot;principal.username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          角色：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">sec:authentication</span>=<span class="hljs-string">&quot;principal.authorities&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;isAuthenticated()&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;address card icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 注销
       <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>
</li>
</ul>
</li>
<li><p>重启测试，我们可以登录试试看，登录成功后确实，显示了我们想要的页面；</p>
</li>
<li><p>如果注销404了，就是因为它默认防止csrf跨站请求伪造，因为会产生安全问题，我们可以将请求改为post表单提交，或者在spring security中关闭csrf功能；我们试试：在 配置中增加 <code>http.csrf().disable();</code></p>
<div class="code-wrapper"><pre><code class="hljs java">http.csrf().disable();<span class="hljs-comment">//关闭csrf功能:跨站请求伪造,默认只能通过post方式提交logout请求</span>
http.logout().logoutSuccessUrl(<span class="hljs-string">&quot;/&quot;</span>);</code></pre></div>
</li>
<li><p>我们继续将下面的角色功能块认证完成！</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- sec:authorize=&quot;hasRole(&#x27;vip1&#x27;)&quot; --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;column&quot;</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;hasRole(&#x27;vip1&#x27;)&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui raised segment&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>Level 1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level1/1&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-1-1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level1/2&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-1-2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level1/3&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-1-3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
           <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;column&quot;</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;hasRole(&#x27;vip2&#x27;)&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui raised segment&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>Level 2<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level2/1&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-2-1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level2/2&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-2-2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level2/3&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-2-3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
           <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;column&quot;</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;hasRole(&#x27;vip3&#x27;)&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui raised segment&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>Level 3<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level3/1&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-3-1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level3/2&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-3-2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level3/3&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-3-3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
           <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>
</li>
<li><p>测试一下！</p>
</li>
<li><p>权限控制和注销搞定！</p>
</li>
</ol>
<h3 id="7-5-记住我"><a href="#7-5-记住我" class="headerlink" title="7.5 记住我"></a>7.5 记住我</h3><p>现在的情况，我们只要登录之后，关闭浏览器，再登录，就会让我们重新登录，但是很多网站的情况，就是有一个记住密码的功能，这个该如何实现呢？很简单</p>
<ol>
<li><p>开启记住我功能</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//定制请求的授权规则</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
<span class="hljs-comment">//。。。。。。。。。。。</span>
   <span class="hljs-comment">//记住我</span>
   http.rememberMe();
&#125;</code></pre></div>
</li>
<li><p>我们再次启动项目测试一下，发现登录页多了一个记住我功能，我们登录之后关闭 浏览器，然后重新打开浏览器访问，发现用户依旧存在！</p>
<p>思考：如何实现的呢？其实非常简单</p>
<p>我们可以查看浏览器的cookie</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/63340.png" alt="查看浏览器的cookie"></p>
</li>
<li><p>我们点击注销的时候，可以发现，spring security 帮我们自动删除了这个 cookie</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/640" alt></p>
</li>
<li><p>结论：登录成功后，将cookie发送给浏览器保存，以后登录带上这个cookie，只要通过检查就可以免登录了。如果点击注销，则会删除这个cookie，具体的原理我们在JavaWeb阶段都讲过了，这里就不在多说了！</p>
</li>
</ol>
<h3 id="7-6-首页定制"><a href="#7-6-首页定制" class="headerlink" title="7.6 首页定制"></a>7.6 首页定制</h3><p>现在这个登录页面都是spring security 默认的，怎么样可以使用我们自己写的Login界面呢？</p>
<ol>
<li><p>在刚才的登录页配置后面指定 loginpage</p>
<div class="code-wrapper"><pre><code class="hljs java">http.formLogin().loginPage(<span class="hljs-string">&quot;/toLogin&quot;</span>);</code></pre></div>
</li>
<li><p>然后前端也需要指向我们自己定义的 login请求</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;address card icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 登录
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></code></pre></div>
</li>
<li><p>我们登录，需要将这些信息发送到哪里，我们也需要配置，login.html 配置提交请求及方式，方式必须为post:</p>
<p>在 loginPage()源码中的注释上有写明：</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210523205655543.png" alt></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/login&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;field&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui left icon input&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Username&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;user icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;field&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui left icon input&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;lock icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui blue submit button&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre></div>
</li>
<li><p>这个请求提交上来，我们还需要验证处理，怎么做呢？我们可以查看formLogin()方法的源码！我们配置接收登录的用户名和密码的参数！</p>
<div class="code-wrapper"><pre><code class="hljs java">http.formLogin()
  .usernameParameter(<span class="hljs-string">&quot;username&quot;</span>)
  .passwordParameter(<span class="hljs-string">&quot;password&quot;</span>)
  .loginPage(<span class="hljs-string">&quot;/toLogin&quot;</span>)
  .loginProcessingUrl(<span class="hljs-string">&quot;/login&quot;</span>); <span class="hljs-comment">// 登陆表单提交请求</span></code></pre></div>
</li>
<li><p>在登录页增加记住我的多选框</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remember&quot;</span>&gt;</span> 记住我</code></pre></div>
</li>
<li><p>后端验证处理！</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//定制记住我的参数！</span>
http.rememberMe().rememberMeParameter(<span class="hljs-string">&quot;remember&quot;</span>);</code></pre></div>

</li>
</ol>
<h2 id="8-Shiro"><a href="#8-Shiro" class="headerlink" title="8 Shiro"></a>8 Shiro</h2><h3 id="8-1-什么是-Shiro"><a href="#8-1-什么是-Shiro" class="headerlink" title="8.1 什么是 Shiro?"></a>8.1 什么是 Shiro?</h3><p>● <code>Apache Shiro</code> 是一个 Java 的安全(权限)框架。<br>● <code>Shiro</code> 可以非常容易的开发出足够好的应用，其不仅可以用在JavaSE环境，也可以用在JavaEE环境。<br>● <code>Shiro</code> 可以完成，认证，授权，加密，会话管理，Web集成，缓存等。<br>● 下载地址: <code>http://shiro.apache.org/</code></p>
<h4 id="8-1-1-有哪些功能"><a href="#8-1-1-有哪些功能" class="headerlink" title="8.1.1 有哪些功能"></a>8.1.1 有哪些功能</h4><p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210316211939796.png" alt></p>
<p>● <code>Authentication</code>: 身份认证、登录，验证用户是不是拥有相应的身份；<br>● <code>Authorization</code>: 授权，即权限验证，验证某个已认证的用户是否拥有某个权限，即判断用户能否进行什么操作，如：验证某个用户是否拥有某个角色，或者细粒度的验证某个用户对某个资源是否具有某个权限!<br>● <code>Session Manager</code>: 会话管理，即用户登录后就是第一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通的JavaSE环境，也可以是Web环境；<br>● <code>Cryptography</code>: 加密，保护数据的安全性，如密码加密存储到数据库中，而不是明文存储；<br>● <code>Web Support</code> : Web支持，可以非常容易的集成到Web环境；<br>● <code>Caching</code> : 缓存，比如用户登录后，其用户信息，拥有的角色、权限不必每次去查，这样可以提高效率。<br>● <code>Concurrency</code>: Shiro支持多线程应用的并发验证，即：如在一个线程中开启另一个线程，能把权限自动的传播过去。<br>● <code>Testing</code>: 提供测试支持；<br>● <code>RunAs</code>: 允许一个用户假装为另一个用户(如果他们允许)的身份进行访问；<br>● <code>Remember Me</code>: 记住我，这个是非常常见的功能，即一次登录后， 下次再来的话不用登录了。</p>
<h4 id="8-1-2-Shiro架构-外部"><a href="#8-1-2-Shiro架构-外部" class="headerlink" title="8.1.2 Shiro架构(外部)"></a>8.1.2 Shiro架构(外部)</h4><p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210316212212655.png" alt></p>
<p>● <code>subject</code>: 应用代码直接交互的对象是Subject，也就是说Shiro的对外API核心就是Subject，Subject代表了当前的用户，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是Subject，如网络爬虫，机器人等，与Subject的所有交互都会委托给SecurityManager；Subject其实是一个门面，SecurityManageer 才是实际的执行者。<br>● <code>SecurityManager</code>: 安全管理器，即所有与安全有关的操作都会与SercurityManager交互，并且它管理着所有的Subject，可以看出它是Shiro的核心，它负责与Shiro的其他组件进行交互，它相当于SpringMVC的DispatcherServlet的角色。<br>● <code>Realm</code>: Shiro从Realm获取安全数据 (如用户,角色，权限)，就是说SecurityManager要验证用户身份，那么它需要从Realm获取相应的用户进行比较，来确定用户的身份是否合法;也需要从Realm得到用户相应的角色、权限，进行验证用户的操作是否能够进行，可以把Realm看DataSource。</p>
<h4 id="8-1-3-Shiro架构-内部"><a href="#8-1-3-Shiro架构-内部" class="headerlink" title="8.1.3 Shiro架构(内部)"></a>8.1.3 Shiro架构(内部)</h4><p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210316212357831.png" alt></p>
<p>● <code>Subject</code>: 任何可以与应用交互的用户;<br>● <code>Security Manager</code>: 相当于SpringMVC中的DispatcherSerlet；是Shiro的心脏， 所有具体的交互都通过Security Manager进行控制，它管理者所有的Subject, 且负责进行认证,授权，会话，及缓存的管理。<br>● <code>Authenticator</code>: 负责Subject认证， 是-一个扩展点，可以自定义实现;可以使用认证策略(Authentication Strategy)，即什么情况下算用户认证通过了;<br>● <code>Authorizer</code>: 授权器，即访问控制器，用来决定主体是否有权限进行相应的操作，即控制着用户能访问应用中的那些功能；<br>● <code>Realm</code>: 可以有一个或者多个的realm，可以认为是安全实体数据源，即用于获取安全实体的，可以用JDBC实现，也可以是内存实现等等，由用户提供；所以一般在应用中都需要实现自己的realm。<br>● <code>SessionManager</code>: 管理Session生命周期的组件，而Shiro并不仅仅可以用在Web环境，也可以用在普通的JavaSE环境中。<br>● <code>CacheManager</code>: 缓存控制器，来管理如用户，角色，权限等缓存的;因为这些数据基本上很少改变，放到缓存中后可以提高访问的性能。<br>● <code>Cryptography</code>: 密码模块，Shiro 提高了一些常见的加密组件用于密码加密， 解密等。</p>
<h3 id="8-2-Shiro快速开始"><a href="#8-2-Shiro快速开始" class="headerlink" title="8.2 Shiro快速开始"></a>8.2 Shiro快速开始</h3><p>创建一个普通<code>maven</code>项目<code>springboot-06-shiro</code>,然后删除src目录,这样的话就可以在这个项目里新建很多model.</p>
<p>在springboot-06-shiro里新建model <code>shiro-01-helloshiro</code><br>父依赖<code>pom.xml</code></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- configure logging --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>

<p><code>log4j.properties</code></p>
<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">log4j.rootLogger</span>=<span class="hljs-string">INFO, stdout</span>

<span class="hljs-meta">log4j.appender.stdout</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span>
<span class="hljs-meta">log4j.appender.stdout.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span>
<span class="hljs-meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="hljs-string">%d %p [%c] - %m %n</span>

<span class="hljs-comment"># General Apache libraries</span>
<span class="hljs-meta">log4j.logger.org.apache</span>=<span class="hljs-string">WARN</span>

<span class="hljs-comment"># Spring</span>
<span class="hljs-meta">log4j.logger.org.springframework</span>=<span class="hljs-string">WARN</span>

<span class="hljs-comment"># Default Shiro logging</span>
<span class="hljs-meta">log4j.logger.org.apache.shiro</span>=<span class="hljs-string">INFO</span>

<span class="hljs-comment"># Disable verbose logging</span>
<span class="hljs-meta">log4j.logger.org.apache.shiro.util.ThreadContext</span>=<span class="hljs-string">WARN</span>
<span class="hljs-meta">log4j.logger.org.apache.shiro.cache.ehcache.EhCache</span>=<span class="hljs-string">WARN</span>
</code></pre></div>

<p><code>shiro.ini</code></p>
<div class="code-wrapper"><pre><code class="hljs ini"><span class="hljs-section">[users]</span>
<span class="hljs-comment"># user &#x27;root&#x27; with password &#x27;secret&#x27; and the &#x27;admin&#x27; role</span>
<span class="hljs-attr">root</span> = secret, admin
<span class="hljs-comment"># user &#x27;guest&#x27; with the password &#x27;guest&#x27; and the &#x27;guest&#x27; role</span>
<span class="hljs-attr">guest</span> = guest, guest
<span class="hljs-comment"># user &#x27;presidentskroob&#x27; with password &#x27;12345&#x27; (&quot;That&#x27;s the same combination on</span>
<span class="hljs-comment"># my luggage!!!&quot; ;)), and role &#x27;president&#x27;</span>
<span class="hljs-attr">presidentskroob</span> = <span class="hljs-number">12345</span>, president
<span class="hljs-comment"># user &#x27;darkhelmet&#x27; with password &#x27;ludicrousspeed&#x27; and roles &#x27;darklord&#x27; and &#x27;schwartz&#x27;</span>
<span class="hljs-attr">darkhelmet</span> = ludicrousspeed, darklord, schwartz
<span class="hljs-comment"># user &#x27;lonestarr&#x27; with password &#x27;vespa&#x27; and roles &#x27;goodguy&#x27; and &#x27;schwartz&#x27;</span>
<span class="hljs-attr">lonestarr</span> = vespa, goodguy, schwartz

<span class="hljs-comment"># -----------------------------------------------------------------------------</span>
<span class="hljs-comment"># Roles with assigned permissions</span>
<span class="hljs-comment"># </span>
<span class="hljs-comment"># Each line conforms to the format defined in the</span>
<span class="hljs-comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setRoleDefinitions JavaDoc</span>
<span class="hljs-comment"># -----------------------------------------------------------------------------</span>
<span class="hljs-section">[roles]</span>
<span class="hljs-comment"># &#x27;admin&#x27; role has all permissions, indicated by the wildcard &#x27;*&#x27;</span>
<span class="hljs-attr">admin</span> = *
<span class="hljs-comment"># The &#x27;schwartz&#x27; role can do anything (*) with any lightsaber:</span>
<span class="hljs-attr">schwartz</span> = lightsaber:*
<span class="hljs-comment"># The &#x27;goodguy&#x27; role is allowed to &#x27;drive&#x27; (action) the winnebago (type) with</span>
<span class="hljs-comment"># license plate &#x27;eagle5&#x27; (instance specific id)</span>
<span class="hljs-attr">goodguy</span> = winnebago:drive:eagle5</code></pre></div>

<p><code>Quickstart.java</code></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.*;
<span class="hljs-keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;
<span class="hljs-keyword">import</span> org.apache.shiro.realm.text.IniRealm;
<span class="hljs-keyword">import</span> org.apache.shiro.session.Session;
<span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;


<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Simple Quickstart application showing how to use Shiro&#x27;s API.</span>
<span class="hljs-comment"> *</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 0.9 RC2</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Quickstart</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> Logger log = LoggerFactory.getLogger(Quickstart.class);


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;


        DefaultSecurityManager defaultSecurityManager=<span class="hljs-keyword">new</span> DefaultSecurityManager();
        IniRealm iniRealm=<span class="hljs-keyword">new</span> IniRealm(<span class="hljs-string">&quot;classpath:shiro.ini&quot;</span>);
        defaultSecurityManager.setRealm(iniRealm);
        SecurityUtils.setSecurityManager(defaultSecurityManager);


        <span class="hljs-comment">// 获得当前用户对象 Subject</span>
        Subject currentUser = SecurityUtils.getSubject();

        <span class="hljs-comment">// 通过当前用户拿到session</span>
        Session session = currentUser.getSession();
        session.setAttribute(<span class="hljs-string">&quot;someKey&quot;</span>, <span class="hljs-string">&quot;aValue&quot;</span>);
        String value = (String) session.getAttribute(<span class="hljs-string">&quot;someKey&quot;</span>);
        <span class="hljs-keyword">if</span> (value.equals(<span class="hljs-string">&quot;aValue&quot;</span>)) &#123;
            log.info(<span class="hljs-string">&quot;Retrieved the correct value! [&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>);
        &#125;

        <span class="hljs-comment">// 判断当前用户是否被认证</span>
        <span class="hljs-keyword">if</span> (!currentUser.isAuthenticated()) &#123;
            <span class="hljs-comment">//Token:令牌</span>
            UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(<span class="hljs-string">&quot;lonestarr&quot;</span>, <span class="hljs-string">&quot;vespa&quot;</span>);
            token.setRememberMe(<span class="hljs-keyword">true</span>);
            <span class="hljs-keyword">try</span> &#123;
                currentUser.login(token); <span class="hljs-comment">//执行登录操作</span>
            &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException uae) &#123;
                log.info(<span class="hljs-string">&quot;There is no user with username of &quot;</span> + token.getPrincipal());
            &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException ice) &#123;
                log.info(<span class="hljs-string">&quot;Password for account &quot;</span> + token.getPrincipal() + <span class="hljs-string">&quot; was incorrect!&quot;</span>);
            &#125; <span class="hljs-keyword">catch</span> (LockedAccountException lae) &#123;
                log.info(<span class="hljs-string">&quot;The account for username &quot;</span> + token.getPrincipal() + <span class="hljs-string">&quot; is locked.  &quot;</span> +
                        <span class="hljs-string">&quot;Please contact your administrator to unlock it.&quot;</span>);
            &#125;
            <span class="hljs-comment">// ... catch more exceptions here (maybe custom ones specific to your application?</span>
            <span class="hljs-keyword">catch</span> (AuthenticationException ae) &#123;
                <span class="hljs-comment">//unexpected condition?  error?</span>
            &#125;
        &#125;

        <span class="hljs-comment">//say who they are:</span>
        <span class="hljs-comment">//print their identifying principal (in this case, a username):</span>
        log.info(<span class="hljs-string">&quot;User [&quot;</span> + currentUser.getPrincipal() + <span class="hljs-string">&quot;] logged in successfully.&quot;</span>);

        <span class="hljs-comment">//test a role:</span>
        <span class="hljs-keyword">if</span> (currentUser.hasRole(<span class="hljs-string">&quot;schwartz&quot;</span>)) &#123;
            log.info(<span class="hljs-string">&quot;May the Schwartz be with you!&quot;</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            log.info(<span class="hljs-string">&quot;Hello, mere mortal.&quot;</span>);
        &#125;

        <span class="hljs-comment">//粗粒度</span>
        <span class="hljs-keyword">if</span> (currentUser.isPermitted(<span class="hljs-string">&quot;lightsaber:wield&quot;</span>)) &#123;
            log.info(<span class="hljs-string">&quot;You may use a lightsaber ring.  Use it wisely.&quot;</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            log.info(<span class="hljs-string">&quot;Sorry, lightsaber rings are for schwartz masters only.&quot;</span>);
        &#125;

        <span class="hljs-comment">//细粒度</span>
        <span class="hljs-keyword">if</span> (currentUser.isPermitted(<span class="hljs-string">&quot;winnebago:drive:eagle5&quot;</span>)) &#123;
            log.info(<span class="hljs-string">&quot;You are permitted to &#x27;drive&#x27; the winnebago with license plate (id) &#x27;eagle5&#x27;.  &quot;</span> +
                    <span class="hljs-string">&quot;Here are the keys - have fun!&quot;</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            log.info(<span class="hljs-string">&quot;Sorry, you aren&#x27;t allowed to drive the &#x27;eagle5&#x27; winnebago!&quot;</span>);
        &#125;

        <span class="hljs-comment">//注销</span>
        currentUser.logout();

        <span class="hljs-comment">//结束</span>
        System.exit(<span class="hljs-number">0</span>);
    &#125;
&#125;</code></pre></div>

<p><code>执行</code></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210526182438396.png" alt></p>
<h3 id="8-3-springboot整合shiro"><a href="#8-3-springboot整合shiro" class="headerlink" title="8.3 springboot整合shiro"></a>8.3 springboot整合shiro</h3><h4 id="8-3-1-项目结构图"><a href="#8-3-1-项目结构图" class="headerlink" title="8.3.1 项目结构图"></a>8.3.1 项目结构图</h4><p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210317223239457.png" alt></p>
<h4 id="8-3-2-数据库"><a href="#8-3-2-数据库" class="headerlink" title="8.3.2 数据库"></a>8.3.2 数据库</h4><p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210317223311431.png" alt></p>
<h4 id="8-3-3-程序代码"><a href="#8-3-3-程序代码" class="headerlink" title="8.3.3 程序代码"></a>8.3.3 程序代码</h4><p>新建一个springboot项目，勾选web，thymeleaf模块</p>
<ul>
<li><p><strong>pom.xml</strong></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    	<span class="hljs-comment">&lt;!--shiro-thymeleaf--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
		<span class="hljs-comment">&lt;!--shiro--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--web--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
				<span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--log4j2--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--test--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--lombok--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.18<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--jdbc--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.8.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--mybatis--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--mysql--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.20<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--Thymeleaf--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		
		<span class="hljs-comment">&lt;!--druid--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>
</li>
<li><p><strong>application.yml</strong></p>
<div class="code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">banner:</span>
    <span class="hljs-attr">location:</span> <span class="hljs-string">banner.txt</span>
  <span class="hljs-attr">thymeleaf:</span>
    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># 配置国际化</span>
  <span class="hljs-attr">messages:</span>
    <span class="hljs-attr">basename:</span> <span class="hljs-string">i18n.login</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/springbootweb?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=true&amp;serverTimezone=GMT</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>

    <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall,log4j2</span>
    <span class="hljs-attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="hljs-number">20</span>
    <span class="hljs-attr">useGlobalDataSourceStat:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">connectionProperties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span>

<span class="hljs-attr">logging:</span>
  <span class="hljs-comment">#  控制台打印格式</span>
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">console:</span> <span class="hljs-string">&quot;%style&#123;%d&#123;yyyy-MM-dd HH:mm:ss&#125;&#125;&#123;red&#125; %style&#123;[%thread]&#125;&#123;blue&#125; %style&#123;%-5level&#125;&#123;cyan&#125;:%highlight&#123;%m%n&#125;&quot;</span>
    
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.pnca.pojo</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span></code></pre></div>
</li>
<li><p><strong>UserRealm.java</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.config;

<span class="hljs-keyword">import</span> com.pnca.pojo.User;
<span class="hljs-keyword">import</span> com.pnca.service.UserService;
<span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.*;
<span class="hljs-keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;
<span class="hljs-keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;
<span class="hljs-keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;
<span class="hljs-keyword">import</span> org.apache.shiro.session.Session;
<span class="hljs-keyword">import</span> org.apache.shiro.subject.PrincipalCollection;
<span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    UserService userService;

    <span class="hljs-comment">//授权</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> </span>&#123;
        System.out.println(<span class="hljs-string">&quot;执行了授权&quot;</span>);

        SimpleAuthorizationInfo info = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo ();

        <span class="hljs-comment">//拿到当前登录的对象</span>
        Subject subject = SecurityUtils.getSubject();
        <span class="hljs-comment">//拿到user对象</span>
        User currentUser = (User) subject.getPrincipal();
        <span class="hljs-comment">//添加权限（数据库中拿的）</span>
        info.addStringPermission(currentUser.getPerms());
        <span class="hljs-keyword">return</span> info;
    &#125;

    <span class="hljs-comment">//认证</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;
        System.out.println(<span class="hljs-string">&quot;执行了认证&quot;</span>);

        UsernamePasswordToken userToken=(UsernamePasswordToken)token;

<span class="hljs-comment">//        //用户名、密码  模拟从数据库中获取</span>
<span class="hljs-comment">//        String name = &quot;root&quot;;</span>
<span class="hljs-comment">//        String password = &quot;1111&quot;;</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        //用户名认证</span>
<span class="hljs-comment">//        if (!userToken.getUsername().equals(name))&#123;</span>
<span class="hljs-comment">//            return null;//抛出异常 UnknownAccountException</span>
<span class="hljs-comment">//        &#125;</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        //密码认证，shiro做</span>
<span class="hljs-comment">//        return new SimpleAuthenticationInfo(&quot;&quot;,password,&quot;&quot;);</span>

        <span class="hljs-comment">//连接真实数据库</span>
        User user = userService.queryUserByName(userToken.getUsername());
        <span class="hljs-keyword">if</span> (user==<span class="hljs-keyword">null</span>)&#123;<span class="hljs-comment">//没有这个人</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<span class="hljs-comment">//抛出异常 UnknownAccountException</span>
        &#125;

        Subject subject = SecurityUtils.getSubject();
        Session session = subject.getSession();
        session.setAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>,user);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(user,user.getPwd(),<span class="hljs-string">&quot;&quot;</span>);
    &#125;
&#125;</code></pre></div>
</li>
<li><p><strong>ShiroConfig.java</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.config;

<span class="hljs-keyword">import</span> at.pollux.thymeleaf.shiro.dialect.ShiroDialect;
<span class="hljs-keyword">import</span> org.apache.shiro.realm.Realm;
<span class="hljs-keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;
<span class="hljs-keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-keyword">import</span> java.util.LinkedHashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span></span>&#123;

    <span class="hljs-comment">//ShiroFilterFactoryBean 第三步</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterFactoryBean  <span class="hljs-title">getShiroFilterBean</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;securityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;
        ShiroFilterFactoryBean bean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();
        <span class="hljs-comment">//设置安全管理器</span>
        bean.setSecurityManager(defaultWebSecurityManager);

        Map&lt;String, String&gt; filterMap =<span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();
        
        <span class="hljs-comment">// 添加Shiro内置过滤器</span>
        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * Shiro内置过滤器，可以实现权限相关的拦截器</span>
<span class="hljs-comment">         *  常用的过滤器：</span>
<span class="hljs-comment">         *      anon：无需认证（登陆）可以访问</span>
<span class="hljs-comment">         *      authc：必须认证才可以访问</span>
<span class="hljs-comment">         *      user：如果使用rememberMe的功能，可以直接访问</span>
<span class="hljs-comment">         *      perms：该资源必须得到资源权限才可以访问</span>
<span class="hljs-comment">         *      role：该资源必须得到角色权限才可以访问</span>
<span class="hljs-comment">         */</span>
        <span class="hljs-comment">//拦截，必须有什么权限才能访问</span>
        filterMap.put(<span class="hljs-string">&quot;/user/add&quot;</span>,<span class="hljs-string">&quot;perms[user:add]&quot;</span>);
        filterMap.put(<span class="hljs-string">&quot;/user/update&quot;</span>,<span class="hljs-string">&quot;perms[user:update]&quot;</span>);
        
        <span class="hljs-comment">//拦截，必须认证才能访问</span>
        <span class="hljs-comment">//filterMap.put(&quot;/user/*&quot;,&quot;authc&quot;);</span>

        bean.setFilterChainDefinitionMap(filterMap);

        <span class="hljs-comment">//访问时用户未认证，跳转到登录界面</span>
        bean.setLoginUrl(<span class="hljs-string">&quot;/toLogin&quot;</span>);
        <span class="hljs-comment">//若访问时用户未被授权，则跳转至未授权页面</span>
        bean.setUnauthorizedUrl(<span class="hljs-string">&quot;/noauth&quot;</span>);

        <span class="hljs-keyword">return</span> bean;
    &#125;

    <span class="hljs-comment">//DefaultWebSecurityManager 第二步</span>
    <span class="hljs-meta">@Bean(name = &quot;securityManager&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DefaultWebSecurityManager <span class="hljs-title">getDefaultWebSecurityManager</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;userRealm&quot;)</span> Realm realm)</span></span>&#123;
        DefaultWebSecurityManager securityManager = <span class="hljs-keyword">new</span> DefaultWebSecurityManager();
        <span class="hljs-comment">//关联userRealm</span>
        securityManager.setRealm(realm);
        <span class="hljs-keyword">return</span> securityManager;
    &#125;

    <span class="hljs-comment">//realm 第一步</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Realm <span class="hljs-title">userRealm</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserRealm();
    &#125;

    <span class="hljs-comment">//整合ShiroDialect:用来整合shiro thymeleaf</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroDialect <span class="hljs-title">getShiroDialect</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ShiroDialect();
    &#125;
&#125;</code></pre></div>
</li>
<li><p><strong>MyController.java</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.controller;

<span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.UnknownAccountException;
<span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;
<span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;

<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyController</span> </span>&#123;

    <span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toIndex</span><span class="hljs-params">(Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;hello,shiro&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;
    &#125;

    <span class="hljs-meta">@RequestMapping(&quot;/user/add&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">add</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user/add&quot;</span>;
    &#125;

    <span class="hljs-meta">@RequestMapping(&quot;/user/update&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">update</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user/update&quot;</span>;
    &#125;

    <span class="hljs-meta">@RequestMapping(&quot;/toLogin&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toLogin</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;
    &#125;

    <span class="hljs-meta">@RequestMapping(&quot;/noauth&quot;)</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">unauthorized</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未授权无法访问此页面&quot;</span>;
    &#125;

    <span class="hljs-meta">@RequestMapping(&quot;/login&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String username,String password,Model model)</span> </span>&#123;
        <span class="hljs-comment">//获取当前用户</span>
        Subject subject = SecurityUtils.getSubject();
        <span class="hljs-comment">//封装用户的登录数据</span>
        UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(username, password);

        <span class="hljs-keyword">try</span> &#123;
            subject.login(token);<span class="hljs-comment">//执行登录的方法，如果没有异常就说明ok了</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<span class="hljs-comment">//登录成功跳到首页</span>
        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123; <span class="hljs-comment">//用户名不存在</span>
            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;用户名不存在！&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;
        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;
            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;密码错误！&quot;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;
        &#125;

    &#125;

    <span class="hljs-meta">@RequestMapping(&quot;/logout&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">logout</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-comment">//获取当前用户</span>
        Subject subject = SecurityUtils.getSubject();
        subject.logout(); <span class="hljs-comment">// session 会销毁，在SessionListener监听session销毁，清理权限缓存</span>
        System.out.println(<span class="hljs-string">&quot;执行了退出&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:index&quot;</span>;
    &#125;

&#125;</code></pre></div>
</li>
<li><p><strong>User.java</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.pojo;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String pwd;
    <span class="hljs-keyword">private</span> String perms;
&#125;</code></pre></div>
</li>
<li><p><strong>UserMapper.java</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.mapper;

<span class="hljs-keyword">import</span> com.kuang.pojo.User;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;

<span class="hljs-meta">@Repository</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByName</span><span class="hljs-params">(String name)</span></span>;

&#125;</code></pre></div>
</li>
<li><p><strong>UserServiceImpl.java</strong></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.pnca.service;

<span class="hljs-keyword">import</span> com.kuang.mapper.UserMapper;
<span class="hljs-keyword">import</span> com.kuang.pojo.User;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span></span>&#123;

    <span class="hljs-meta">@Autowired</span>
    UserMapper userMapper;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByName</span><span class="hljs-params">(String name)</span> </span>&#123;
        <span class="hljs-keyword">return</span> userMapper.queryUserByName(name);
    &#125;
&#125;</code></pre></div>
</li>
<li><p><strong>index.html</strong></p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span></span>
<span class="hljs-tag">      <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;https://www.thymeleaf.org&quot;</span></span>
<span class="hljs-tag">      <span class="hljs-attr">xmlns:shiro</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org/thymeleaf-extras-shiro&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;session.loginUser==null&#125;&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;session.loginUser!=null&#125;&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span>注销<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">shiro:hasPermission</span>=<span class="hljs-string">&quot;user:add&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">shiro:hasPermission</span>=<span class="hljs-string">&quot;user:update&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>
</li>
<li><p><strong>login.html</strong></p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml?&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:red;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span>
    用户名：<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
    密码：<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;提交&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>
</li>
<li><p><strong>add.html</strong></p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>
</li>
<li><p><strong>update.html</strong></p>
<div class="code-wrapper"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>修改<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

</li>
</ul>
<h3 id="8-4-总结"><a href="#8-4-总结" class="headerlink" title="8.4 总结"></a>8.4 总结</h3><h4 id="8-4-1-Shiro-三大要素"><a href="#8-4-1-Shiro-三大要素" class="headerlink" title="8.4.1 Shiro 三大要素"></a>8.4.1 Shiro 三大要素</h4><ul>
<li><p><code>subject</code> -&gt; <code>ShiroFilterFactoryBean</code></p>
</li>
<li><p><code>securityManager</code> -&gt; <code>DefaultWebSecurityManager</code></p>
</li>
<li><p><code>realm</code> </p>
</li>
<li><p>实际操作中对象创建的顺序 ： <code>realm -&gt; securityManager -&gt; subject</code></p>
</li>
</ul>
<h4 id="8-4-2-流程梳理"><a href="#8-4-2-流程梳理" class="headerlink" title="8.4.2 流程梳理"></a>8.4.2 流程梳理</h4><ol>
<li><p>用户进入首页点击跳转，Shiro内置过滤器进行拦截，看过滤器的设置，未认证跳转到登录页面，未授权跳转到未授权界面；</p>
</li>
<li><p>认证</p>
<ul>
<li><p>用户进入登录页面，输入用户名密码准备进行认证，点击登录按钮后，会请求/login，</p>
</li>
<li><p>首先调用Subject.login(token) 进行登录，其会自动委托给SecurityManager，</p>
</li>
<li><p>SecurityManager负责真正的身份验证逻辑；它会委托给Authenticator 进行身份验证；</p>
</li>
<li><p>Authenticator 才是真正的身份验证者，Authenticator 会把相应的token 传入Realm，从Realm 获取身份验证信息，如果没有返回/抛出异常表示身份验证失败了，如果有就返回AuthenticationInfo验证信息，此信息中包含了身份（pricipals）及凭证，也就是账号密码。</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210318092122708.png" alt></p>
</li>
</ul>
</li>
<li><p>授权</p>
<ul>
<li>对subject进行授权，调用方法isPermitted（“permission串”），递交给SecurityManager</li>
<li>SecurityManager将权限检测操作委托给Authorizer授权管理器对象</li>
<li>Authorizer执行Realm（自定义的Realm）从数据库查询权限数据并封装</li>
<li>Authorizer对用户授权信息进行判定(判断用户访问资源时需要什么权限，假如用户所具有的权限包含这个资源访问时所需要的权限，那么用户就可以访问这个资源了)。</li>
</ul>
</li>
</ol>
<h2 id="9-swagger"><a href="#9-swagger" class="headerlink" title="9 swagger"></a>9 swagger</h2><h3 id="9-1-概念"><a href="#9-1-概念" class="headerlink" title="9.1 概念"></a>9.1 概念</h3><p>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。总体目标是使客户端和文件系统作为服务器以同样的速度来更新。文件的方法，参数和模型紧密集成到服务器端的代码，允许API来始终保持同步。</p>
<h3 id="9-2-特点"><a href="#9-2-特点" class="headerlink" title="9.2  特点"></a>9.2  特点</h3><ul>
<li>号称世界上最流行的API框架</li>
<li>Restful Api 文档在线自动生成器 =&gt; API 文档 与API 定义同步更新</li>
<li>直接运行，在线测试API</li>
<li>支持多种语言 （如：Java，PHP等）</li>
<li>官网：<a target="_blank" rel="noopener" href="https://swagger.io/">https://swagger.io/</a></li>
</ul>
<h3 id="9-3-springboot-集成-swagger"><a href="#9-3-springboot-集成-swagger" class="headerlink" title="9.3 springboot 集成 swagger"></a>9.3 springboot 集成 swagger</h3><ul>
<li>1 引入依赖</li>
</ul>
<p>以maven为例：</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>

<ul>
<li>2 自定义配置信息</li>
</ul>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span> <span class="hljs-comment">//配置类</span>
<span class="hljs-meta">@EnableSwagger2</span><span class="hljs-comment">// 开启Swagger2的自动配置</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> </span>&#123;  
&#125;</code></pre></div>

<ul>
<li>3 测试</li>
</ul>
<p>​    <a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></p>
<p>​    <img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210531203708046.png" alt="image-20210531203708046"></p>
<h4 id="1-配置swagger"><a href="#1-配置swagger" class="headerlink" title="1 配置swagger"></a>1 配置swagger</h4><ul>
<li><p>Swagger实例Bean是<code>Docket</code>，所以通过配置Docket实例来配置Swaggger。</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span> <span class="hljs-comment">//配置docket以配置Swagger具体参数</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span> </span>&#123;
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2);
&#125;</code></pre></div>
</li>
<li><p>可以通过<code>apiInfo()</code>属性配置文档信息</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//配置文档信息</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title">apiInfo</span><span class="hljs-params">()</span> </span>&#123;
   Contact contact = <span class="hljs-keyword">new</span> Contact(<span class="hljs-string">&quot;联系人名字&quot;</span>, <span class="hljs-string">&quot;http://xxx.xxx.com/联系人访问链接&quot;</span>, <span class="hljs-string">&quot;联系人邮箱&quot;</span>);
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiInfo(
           <span class="hljs-string">&quot;Swagger学习&quot;</span>, <span class="hljs-comment">// 标题</span>
           <span class="hljs-string">&quot;学习演示如何配置Swagger&quot;</span>, <span class="hljs-comment">// 描述</span>
           <span class="hljs-string">&quot;v1.0&quot;</span>, <span class="hljs-comment">// 版本</span>
           <span class="hljs-string">&quot;http://terms.service.url/组织链接&quot;</span>, <span class="hljs-comment">// 组织链接</span>
           contact, <span class="hljs-comment">// 联系人信息</span>
           <span class="hljs-string">&quot;Apach 2.0 许可&quot;</span>, <span class="hljs-comment">// 许可</span>
           <span class="hljs-string">&quot;许可链接&quot;</span>, <span class="hljs-comment">// 许可连接</span>
           <span class="hljs-keyword">new</span> ArrayList&lt;&gt;()<span class="hljs-comment">// 扩展</span>
  );
&#125;</code></pre></div>
</li>
<li><p>Docket 实例关联上 apiInfo()</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span> </span>&#123;
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo());
&#125;</code></pre></div>
</li>
<li><p>重启项目，访问测试 <code>http://localhost:8080/swagger-ui.html</code> 看下效果</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210531204628474.png" alt></p>
</li>
</ul>
<h4 id="2-配置扫描接口"><a href="#2-配置扫描接口" class="headerlink" title="2 配置扫描接口"></a>2 配置扫描接口</h4><ul>
<li><p>构建Docket时通过<code>select()</code>方法配置怎么扫描接口。</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span> </span>&#123;
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)
      .apiInfo(apiInfo())
      .select()<span class="hljs-comment">// 通过.select()方法，去配置扫描接口,RequestHandlerSelectors配置如何扫描接口</span>
      .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.kuang.controller&quot;</span>))
      .build();
&#125;</code></pre></div>
</li>
<li><p>重启项目测试，由于我们配置根据包的路径扫描接口，所以我们只能看到一个类</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/image-20210531205542660.png" alt="image-20210531205542660"></p>
</li>
<li><p>除了通过包路径配置扫描接口外，还可以通过配置其他方式扫描接口，这里注释一下所有的配置方式：</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//RequestHandlerSelectors 配置要扫描接口的方式</span>
<span class="hljs-comment">//basePackage 指定要扫描的包</span>
<span class="hljs-comment">//any() 扫描全部</span>
<span class="hljs-comment">//none() 不扫描</span>
<span class="hljs-comment">//withMethodAnnotation 扫描方法上的注解，参数是注解的反射对象（GetMapping.class）</span>
<span class="hljs-comment">//withClassAnnotation 扫描类上的注解（RestController.class）</span></code></pre></div>
</li>
<li><p>除此之外，我们还可以配置接口扫描过滤：</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)
        .apiInfo(apiInfo())
        .select()
        .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.pnca.controller&quot;</span>))
        .paths(PathSelectors.ant(<span class="hljs-string">&quot;/pnca/**&quot;</span>)) <span class="hljs-comment">//请求中有pnca的</span>
        .build();
&#125;</code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210322222012279.png" alt="在这里插入图片描述"></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210322222052375.png" alt="在这里插入图片描述"></p>
</li>
</ul>
<h4 id="3-配置Swagger开关"><a href="#3-配置Swagger开关" class="headerlink" title="3 配置Swagger开关"></a>3 配置Swagger开关</h4><ul>
<li><p>通过<code>enable()</code>方法配置是否启用swagger，如果是false，swagger将不能在浏览器中访问了</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">(Environment environment)</span></span>&#123;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)
            .apiInfo(apiInfo())
            .enable(<span class="hljs-keyword">false</span>)
            .select()
            .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.pnca.controller&quot;</span>))
            .paths(PathSelectors.ant(<span class="hljs-string">&quot;/hello&quot;</span>))
            .build();
&#125;</code></pre></div>
</li>
<li><p>如何动态配置当项目处于test、dev环境时显示swagger，处于prod时不显示？</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">(Environment environment)</span> </span>&#123;
   <span class="hljs-comment">// 设置要显示swagger的环境</span>
   Profiles of = Profiles.of(<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);
   <span class="hljs-comment">// 判断当前是否处于该环境</span>
   <span class="hljs-comment">// 通过 enable() 接收此参数判断是否要显示</span>
   <span class="hljs-keyword">boolean</span> flag = environment.acceptsProfiles(of);
   
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)
      .apiInfo(apiInfo())
      .enable(flag) <span class="hljs-comment">//配置是否启用Swagger，如果是false，在浏览器将无法访问</span>
      .select()<span class="hljs-comment">// 通过.select()方法，去配置扫描接口,RequestHandlerSelectors配置如何扫描接口</span>
      .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.kuang.swagger.controller&quot;</span>))
       <span class="hljs-comment">// 配置如何通过path过滤,即这里只扫描请求以/kuang开头的接口</span>
      .paths(PathSelectors.ant(<span class="hljs-string">&quot;/kuang/**&quot;</span>))
      .build();
&#125;</code></pre></div>
</li>
<li><p>springboot切换使用环境，如果是<code>Profiles.of(&quot;dev&quot;, &quot;test&quot;)</code>这里有的环境，则正常显示，如果是这里没有的则无法使用。</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329203939370.png" alt="在这里插入图片描述"></p>
</li>
</ul>
<h4 id="4-配置API分组"><a href="#4-配置API分组" class="headerlink" title="4 配置API分组"></a>4 配置API分组</h4><ol>
<li><p>如果没有配置分组，默认是default。通过<code>groupName()</code>方法即可配置分组</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329204226225.png" alt></p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">(Environment environment)</span> </span>&#123;
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo())
      .groupName(<span class="hljs-string">&quot;hello&quot;</span>) <span class="hljs-comment">// 配置分组</span>
       <span class="hljs-comment">// 省略配置....</span>
&#125;</code></pre></div>
</li>
<li><p>如何<code>配置多个分组</code>？配置多个分组只需要配置多个docket即可</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">(Environment environment)</span></span>&#123;

    Profiles of = Profiles.of(<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);
    <span class="hljs-keyword">boolean</span> flag = environment.acceptsProfiles(of);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)
            .apiInfo(apiInfo())
            .groupName(<span class="hljs-string">&quot;狂神&quot;</span>)
            .enable(f)
            .select()
            .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.kuang.controller&quot;</span>))
            .paths(PathSelectors.ant(<span class="hljs-string">&quot;/hello&quot;</span>))
            .build();
&#125;

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket2</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;group1&quot;</span>);
&#125;

<span class="hljs-meta">@Bean</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket3</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;group2&quot;</span>);
&#125;</code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329204504750.png" alt></p>
</li>
</ol>
<h4 id="5-配置注释信息"><a href="#5-配置注释信息" class="headerlink" title="5 配置注释信息"></a>5 配置注释信息</h4><ul>
<li><p>实体类上注解</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ApiModel(&quot;用户实体类&quot;)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-meta">@ApiModelProperty(&quot;用户名&quot;)</span>
    <span class="hljs-keyword">public</span> String name;
    <span class="hljs-meta">@ApiModelProperty(&quot;密码&quot;)</span>
    <span class="hljs-keyword">public</span> String password;
&#125;</code></pre></div>
</li>
<li><p>方法返回值中有存在实体类，就会被扫描</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/user&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">hello2</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User();
&#125;</code></pre></div>
</li>
<li><p>方法上注解</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation(&quot;测试方法&quot;)</span>
<span class="hljs-meta">@GetMapping(&quot;/test&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello3</span><span class="hljs-params">(<span class="hljs-meta">@ApiParam(&quot;用户名&quot;)</span> String name)</span></span>&#123;
    <span class="hljs-keyword">return</span> name;
&#125;</code></pre></div>
</li>
<li><p><strong>常用注解</strong></p>
<ul>
<li>@Api(tags = “xxx模块说明”)：作用在模块类上</li>
<li>@ApiOperation(“xxx接口说明”)：作用在接口方法上</li>
<li>@ApiModel(“xxxPOJO说明”)：作用在模型类上：如VO、BO</li>
<li>@ApiModelProperty(value = “xxx属性说明”,hidden = true)：作用在方法和属性上，hidden设置为true可以隐藏该属性</li>
<li>@ApiParam(“xxx参数说明”)：作用在参数、方法和字段上，类似@ApiModelProperty</li>
</ul>
</li>
<li><p>相较于传统的Postman或Curl方式测试接口，使用swagger简直就是傻瓜式操作，不需要额外说明文档(写得好本身就是文档)而且更不容易出错，只需要录入数据然后点击Execute，如果再配合自动化框架，可以说基本就不需要人为操作了。</p>
</li>
<li><p>Swagger是个优秀的工具，现在国内已经有很多的中小型互联网公司都在使用它，相较于传统的要先出Word接口文档再测试的方式，显然这样也更符合现在的快速迭代开发行情。当然了，提醒下大家在正式环境要记得关闭Swagger，一来出于安全考虑二来也可以节省运行时内存。</p>
</li>
</ul>
<h4 id="6-其他皮肤"><a href="#6-其他皮肤" class="headerlink" title="6 其他皮肤"></a>6 其他皮肤</h4><ol>
<li><p>默认<code>访问</code><a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> 
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329211653264.png" alt></p>
</li>
<li><p>bootstrap-ui 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 引入swagger-bootstrap-ui包 /doc.html--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329211712944.png" alt></p>
</li>
<li><p>Layui-ui 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/docs.html">http://localhost:8080/docs.html</a></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 引入swagger-ui-layer包 /docs.html--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.caspar-chen<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-ui-layer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329211732856.png" alt></p>
</li>
<li><p>mg-ui 访问 <a target="_blank" rel="noopener" href="http://localhost:8080/document.html">http://localhost:8080/document.html</a></p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 引入swagger-ui-layer包 /document.html--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zyplayer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-mg-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210329211751176.png" alt></p>
</li>
</ol>
<h2 id="10-任务"><a href="#10-任务" class="headerlink" title="10 任务"></a>10 任务</h2><h3 id="10-1-异步任务"><a href="#10-1-异步任务" class="headerlink" title="10.1 异步任务"></a>10.1 异步任务</h3><ol>
<li><p>创建一个AsuncService类</p>
<ul>
<li><p>异步处理还是非常常用的，比如我们在网站上发送邮件，后台会去发送邮件，此时前台会造成响应不动，直到邮件发送完毕，响应才会成功，所以我们一般会采用多线程的方式去处理这些任务。</p>
</li>
<li><p>编写方法，假装正在处理数据，使用线程设置一些延时，模拟同步等待的情况；</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncService</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            Thread.sleep(<span class="hljs-number">3000</span>);
        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(<span class="hljs-string">&quot;业务进行中......&quot;</span>);
    &#125;
&#125;</code></pre></div>
</li>
</ul>
</li>
<li><p>创建一个AsyncController类</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    AsyncService asyncService;

    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;
        asyncService.hello();
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;sucess&quot;</span>;
    &#125;
&#125;</code></pre></div>
</li>
<li><p>测试，发现界面没有立即返回结果，而是等后台执行完才返回。</p>
</li>
<li><p>给hello方法添加@Async注解；</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncService</span> </span>&#123;

    <span class="hljs-meta">@Async</span> <span class="hljs-comment">//告诉spring这是一个异步方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            Thread.sleep(<span class="hljs-number">3000</span>);
        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(<span class="hljs-string">&quot;业务进行中......&quot;</span>);
    &#125;
&#125;</code></pre></div>
</li>
<li><p>SpringBoot就会自己开一个线程池，进行调用！但是要让这个注解生效，我们还需要在主程序上添加一个注解@EnableAsync ，开启异步注解功能；</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableAsync</span> <span class="hljs-comment">//开启异步注解功能</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Springboot08TaskApplication</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(Springboot08TaskApplication.class, args);
    &#125;

&#125;</code></pre></div>

<p>重启测试，网页瞬间响应，后台代码继续执行！</p>
</li>
</ol>
<h3 id="10-2-定时任务"><a href="#10-2-定时任务" class="headerlink" title="10.2 定时任务"></a>10.2 定时任务</h3><p>项目开发中经常需要执行一些定时任务，比如需要在每天凌晨的时候，分析一次前一天的日志信息，Spring为我们提供了异步执行任务调度的方式，提供了两个接口。</p>
<ul>
<li>TaskExecutor接口</li>
<li>TaskScheduler接口</li>
</ul>
<p>两个注解：</p>
<ul>
<li>@EnableScheduling</li>
<li>@Scheduled</li>
</ul>
<p><strong>cron表达式：</strong></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210322204802554.jpg" alt></p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210322204802512.jpg" alt></p>
<ol>
<li><p>创建一个ScheduledService类</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScheduledService</span> </span>&#123;

	<span class="hljs-comment">//cron表达式</span>
    <span class="hljs-meta">@Scheduled(cron = &quot;0 9 20 * * 0-7&quot;)</span> <span class="hljs-comment">//每天20:09执行</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;
        System.out.println(<span class="hljs-string">&quot;hello Scheduled....&quot;</span>);
    &#125;
&#125;</code></pre></div>
</li>
<li><p>需要在主程序上增加@EnableScheduling 开启定时任务功能</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableScheduling</span> <span class="hljs-comment">//开启基于注解的定时任务</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Springboot08TaskApplication</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(Springboot08TaskApplication.class, args);
    &#125;

&#125;</code></pre></div>
</li>
<li><p>测试</p>
</li>
<li><p>了解下cron表达式</p>
<p><a target="_blank" rel="noopener" href="http://www.bejson.com/othertools/cron/">http://www.bejson.com/othertools/cron/</a></p>
</li>
<li><p>常用的表达式</p>
<div class="code-wrapper"><pre><code class="hljs dns">（<span class="hljs-number">1</span>）<span class="hljs-number">0</span>/<span class="hljs-number">2</span> * * * * ?   表示每<span class="hljs-number">2</span>秒 执行任务
（<span class="hljs-number">1）0 0/2</span> * * * ?   表示每<span class="hljs-number">2</span>分钟 执行任务
（<span class="hljs-number">1）0 0 2</span> <span class="hljs-number">1</span> * ?   表示在每月的<span class="hljs-number">1</span>日的凌晨<span class="hljs-number">2</span>点调整任务
（<span class="hljs-number">2）0 15 10</span> ? * MON-FRI   表示周一到周五每天上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>执行作业
（<span class="hljs-number">3）0 15 10</span> ? <span class="hljs-number">6</span>L <span class="hljs-number">2002-2006</span>   表示<span class="hljs-number">2002-2006</span>年的每个月的最后一个星期五上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>执行作
（<span class="hljs-number">4）0 0 10</span>,<span class="hljs-number">14</span>,<span class="hljs-number">16</span> * * ?   每天上午<span class="hljs-number">10</span>点，下午<span class="hljs-number">2</span>点，<span class="hljs-number">4</span>点
（<span class="hljs-number">5）0 0/30</span> <span class="hljs-number">9</span>-<span class="hljs-number">17</span> * * ?   朝九晚五工作时间内每半小时
（<span class="hljs-number">6）0 0 12</span> ? * WED   表示每个星期三中午<span class="hljs-number">12</span>点
（<span class="hljs-number">7）0 0 12</span> * * ?   每天中午<span class="hljs-number">12</span>点触发
（<span class="hljs-number">8）0 15 10</span> ? * *   每天上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">9）0 15 10</span> * * ?     每天上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">10）0 15 10</span> * * ?   每天上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">11）0 15 10</span> * * ? <span class="hljs-number">2005</span>   <span class="hljs-number">2005</span>年的每天上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">12</span>）<span class="hljs-number">0</span> * <span class="hljs-number">14</span> * * ?     在每天下午<span class="hljs-number">2</span>点到下午<span class="hljs-number">2</span>:<span class="hljs-number">59</span>期间的每<span class="hljs-number">1</span>分钟触发
（<span class="hljs-number">13）0 0/5</span> <span class="hljs-number">14</span> * * ?   在每天下午<span class="hljs-number">2</span>点到下午<span class="hljs-number">2</span>:<span class="hljs-number">55</span>期间的每<span class="hljs-number">5</span>分钟触发
（<span class="hljs-number">14）0 0/5</span> <span class="hljs-number">14</span>,<span class="hljs-number">18</span> * * ?     在每天下午<span class="hljs-number">2</span>点到<span class="hljs-number">2</span>:<span class="hljs-number">55</span>期间和下午<span class="hljs-number">6</span>点到<span class="hljs-number">6</span>:<span class="hljs-number">55</span>期间的每<span class="hljs-number">5</span>分钟触发
（<span class="hljs-number">15）0 0-5</span> <span class="hljs-number">14</span> * * ?   在每天下午<span class="hljs-number">2</span>点到下午<span class="hljs-number">2</span>:<span class="hljs-number">05</span>期间的每<span class="hljs-number">1</span>分钟触发
（<span class="hljs-number">16）0 10,44</span> <span class="hljs-number">14</span> ? <span class="hljs-number">3</span> WED   每年三月的星期三的下午<span class="hljs-number">2:10和2:44</span>触发
（<span class="hljs-number">17）0 15 10</span> ? * MON-FRI   周一至周五的上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">18）0 15 10</span> <span class="hljs-number">15</span> * ?   每月<span class="hljs-number">15</span>日上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">19）0 15 10</span> L * ?   每月最后一日的上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">20）0 15 10</span> ? * <span class="hljs-number">6</span>L   每月的最后一个星期五上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">21）0 15 10</span> ? * <span class="hljs-number">6</span>L <span class="hljs-number">2002-2005</span>   <span class="hljs-number">2002</span>年至<span class="hljs-number">2005</span>年的每月的最后一个星期五上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发
（<span class="hljs-number">22）0 15 10</span> ? * <span class="hljs-number">6</span>#<span class="hljs-number">3</span>   每月的第三个星期五上午<span class="hljs-number">10</span>:<span class="hljs-number">15</span>触发</code></pre></div>

</li>
</ol>
<h3 id="10-3-邮件发送"><a href="#10-3-邮件发送" class="headerlink" title="10.3 邮件发送"></a>10.3 邮件发送</h3><p>邮件发送，在我们的日常开发中，也非常的多，Springboot也帮我们做了支持</p>
<ul>
<li>邮件发送需要引入spring-boot-start-mail</li>
<li>SpringBoot 自动配置MailSenderAutoConfiguration</li>
<li>定义MailProperties内容，配置在application.yml中</li>
<li>自动装配JavaMailSender</li>
<li>测试邮件发送</li>
</ul>
<ol>
<li><p>引入依赖</p>
<div class="code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>
</li>
<li><p>配置文件</p>
<p>查看一下MailProperties</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(</span>
<span class="hljs-meta">   prefix = &quot;spring.mail&quot;</span>
<span class="hljs-meta">)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailProperties</span> </span>&#123;
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Charset DEFAULT_CHARSET;
   <span class="hljs-keyword">private</span> String host;
   <span class="hljs-keyword">private</span> Integer port;
   <span class="hljs-keyword">private</span> String username;
   <span class="hljs-keyword">private</span> String password;
   <span class="hljs-keyword">private</span> String protocol = <span class="hljs-string">&quot;smtp&quot;</span>;
   <span class="hljs-keyword">private</span> Charset defaultEncoding;
   <span class="hljs-keyword">private</span> Map&lt;String, String&gt; properties;
   <span class="hljs-keyword">private</span> String jndiName;
&#125;</code></pre></div>

<div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.mail.username</span>=<span class="hljs-string">24736743@qq.com</span>
<span class="hljs-meta">spring.mail.password</span>=<span class="hljs-string">你的qq授权码</span>
<span class="hljs-meta">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span>
<span class="hljs-comment"># qq需要配置ssl</span>
<span class="hljs-meta">spring.mail.properties.mail.smtp.ssl.enable</span>=<span class="hljs-string">true</span></code></pre></div>

<p>获取授权码：在QQ邮箱中的设置-&gt;账户-&gt;开启pop3和smtp服务</p>
<p><img src="/uploads/loading.jpg" srcset="/img/loading.gif" lazyload data-original="/2021/04/04/SpringBoot%E5%AD%A6%E4%B9%A0/20210322205732662.jpg" alt></p>
</li>
<li><p>Spring单元测试</p>
<div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Springboot08TaskApplicationTests</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    JavaMailSenderImpl mailSender;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-comment">//方式一：简单的邮件</span>
        SimpleMailMessage message = <span class="hljs-keyword">new</span> SimpleMailMessage();
        message.setSubject(<span class="hljs-string">&quot;通知-明天放假&quot;</span>);
        message.setText(<span class="hljs-string">&quot;今晚7:30开会&quot;</span>);

        message.setTo(<span class="hljs-string">&quot;24736743@qq.com&quot;</span>);
        message.setFrom(<span class="hljs-string">&quot;24736743@qq.com&quot;</span>);
        mailSender.send(message);
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException </span>&#123;
        <span class="hljs-comment">//方式二：复杂的邮件</span>
        MimeMessage mimeMessage = mailSender.createMimeMessage();
        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage, <span class="hljs-keyword">true</span>);

        helper.setSubject(<span class="hljs-string">&quot;通知-明天上课&quot;</span>);
        helper.setText(<span class="hljs-string">&quot;&lt;b style=&#x27;color:red&#x27;&gt;今天 7:30来开会&lt;/b&gt;&quot;</span>,<span class="hljs-keyword">true</span>);

        helper.addAttachment(<span class="hljs-string">&quot;1.jpg&quot;</span>,<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\Users\\Lenovo\\Desktop\\1.jpg&quot;</span>));
        <span class="hljs-comment">//helper.addAttachment(&quot;2.jpg&quot;,new File(&quot;&quot;));</span>

        helper.setTo(<span class="hljs-string">&quot;24736743@qq.com&quot;</span>);
        helper.setFrom(<span class="hljs-string">&quot;24736743@qq.com&quot;</span>);

        mailSender.send(mimeMessage);
    &#125;
&#125;</code></pre></div>

<p>查看邮箱，邮件接收成功！</p>
</li>
</ol>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/Spring/">Spring</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/04/09/Typora%E5%BF%AB%E6%8D%B7%E9%94%AE/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Typora快捷键</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/04/SpringCloud%E5%AD%A6%E4%B9%A0/">
                        <span class="hidden-mobile">SpringCloud 学习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=a;var i=n.imageLazyLoadSetting.isSPA,o=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function a(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var a=0;a<r.length;a++)t=r[a],0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}();var t,e}a(),n.addEventListener("scroll",function(){var t,e;t=a,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
